{% comment %} 产品详情组件 - {% endcomment %}

<div class="product-details">
  <div class="product-details__gallery">
    {% for media in product.media %}
      <div class="product-media">
        {% case media.media_type %}
          {% when 'image' %}
            {{ media | image_url: width: 800 | image_tag: loading: 'lazy', class: 'product-media__image' }}
          {% when 'video' %}
            {{ media | video_tag: controls: true, class: 'product-media__video' }}
          {% when 'external_video' %}
            {{ media | external_video_tag }}
          {% when 'model' %}
            {{ media | model_viewer_tag }}
        {% endcase %}
      </div>
    {% endfor %}
  </div>

  <div class="product-details__info">
    <h1 class="product-title">{{ product.title }}</h1>
    
    <div class="product-price">
      <span class="price">{{ product.price | money }}</span>
      {% if product.compare_at_price > product.price %}
        <span class="compare-price">{{ product.compare_at_price | money }}</span>
        <span class="discount-badge">
          {{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price }}% OFF
        </span>
      {% endif %}
    </div>

    {% if product.variants.size > 1 %}
      <div class="product-variants">
        {% for option in product.options_with_values %}
          <div class="variant-option">
            <label>{{ option.name }}</label>
            <select class="variant-selector" data-option-index="{{ forloop.index0 }}">
              {% for value in option.values %}
                <option value="{{ value | escape }}" {% if option.selected_value == value %}selected{% endif %}>
                  {{ value }}
                </option>
              {% endfor %}
            </select>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="product-description">
      {{ product.description }}
    </div>

    <div class="product-meta">
      {% if product.sku != blank %}
        <div class="meta-item">
          <span class="meta-label">SKU:</span>
          <span class="meta-value">{{ product.sku }}</span>
        </div>
      {% endif %}
      
      {% if product.vendor != blank %}
        <div class="meta-item">
          <span class="meta-label">品牌:</span>
          <span class="meta-value">{{ product.vendor }}</span>
        </div>
      {% endif %}
      
      <div class="meta-item">
        <span class="meta-label">库存:</span>
        <span class="meta-value">
          {% if product.available %}
            有货
          {% else %}
            缺货
          {% endif %}
        </span>
      </div>
    </div>

    <div class="product-actions">
      <input type="number" name="quantity" value="1" min="1" class="quantity-selector">
      <button type="button" class="add-to-cart" {% unless product.available %}disabled{% endunless %}>
        {% if product.available %}
          加入购物车
        {% else %}
          已售罄
        {% endif %}
      </button>
    </div>
  </div>
</div>

<style>
  .product-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  .product-details__gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 15px;
  }

  .product-media {
    position: relative;
    padding-top: 100%;
    background: #f5f5f5;
  }

  .product-media__image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .product-title {
    font-size: 2rem;
    margin-bottom: 20px;
  }

  .product-price {
    margin-bottom: 20px;
  }

  .price {
    font-size: 1.5rem;
    font-weight: bold;
    color: #d82c32;
  }

  .compare-price {
    text-decoration: line-through;
    color: #999;
    margin-left: 10px;
  }

  .discount-badge {
    background: #d82c32;
    color: white;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 0.9rem;
    margin-left: 10px;
  }

  .product-variants {
    margin-bottom: 20px;
  }

  .variant-option {
    margin-bottom: 15px;
  }

  .variant-option label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
  }

  .variant-selector {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }

  .product-description {
    margin-bottom: 30px;
    line-height: 1.6;
  }

  .product-meta {
    margin-bottom: 30px;
    border-top: 1px solid #eee;
    padding-top: 20px;
  }

  .meta-item {
    display: flex;
    margin-bottom: 10px;
  }

  .meta-label {
    font-weight: bold;
    min-width: 80px;
  }

  .product-actions {
    display: flex;
    gap: 15px;
  }

  .quantity-selector {
    width: 80px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    text-align: center;
  }

  .add-to-cart {
    flex: 1;
    padding: 12px 20px;
    background: #d82c32;
    color: white;
    border: none;
    border-radius: 4px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
  }

  .add-to-cart:hover {
    background: #b82228;
  }

  .add-to-cart:disabled {
    background: #999;
    cursor: not-allowed;
  }
</style>

<script>
  document.querySelectorAll('.variant-selector').forEach(select => {
    select.addEventListener('change', function() {
      const optionIndex = this.dataset.optionIndex;
      const optionValue = this.value;
      
      // 这里添加变体选择逻辑
      console.log(`Selected option ${optionIndex}: ${optionValue}`);
    });
  });

  document.querySelector('.add-to-cart').addEventListener('click', function() {
    const quantity = document.querySelector('.quantity-selector').value;
    // 这里添加加入购物车逻辑
    console.log(`Add to cart: ${quantity} items`);
  });
</script>
