{% comment %}
  Custom sidebar menu - fixed on left side
  Usage: {% section 'custom-sidebar' %}
{% endcomment %}

{%- liquid
  # GraphQL query to fetch menus
  assign query = '
    query {
      menus(first: 5) {
        edges {
          node {
            title
            handle
            items {
              title
              url
              items {
                title
                url
              }
            }
          }
        }
      }
    }
  '
  
  # Execute query using Shopify's graphql global object
  assign result = shopify.graphql.execute(query)
  assign menus = result.data.menus.edges | map: 'node'
  
  # Get menu handles from section settings
  assign dropdown_menu_handle = section.settings.dropdown_menu
  assign mega_menu_handle = section.settings.mega_menu
  
  # Find matching menus
  assign dropdown_menu = menus | where: "handle", dropdown_menu_handle | first
  assign mega_menu = menus | where: "handle", mega_menu_handle | first
  
  # Fallback to first menu if none selected
  if dropdown_menu == blank and mega_menu == blank
    assign dropdown_menu = menus.first
  endif
-%}

<style>
  .custom-sidebar {
    position: fixed;
    left: 0;
    top: var(--header-height, 80px);
    width: 280px;
    height: calc(100vh - var(--header-height, 80px));
    background: #fff;
    z-index: 99;
    box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    overflow-y: auto;
  }

  @media screen and (max-width: 749px) {
    .custom-sidebar {
      width: 100%;
      position: static;
      height: auto;
    }
  }
</style>

<div class="custom-sidebar">
  {% comment %} Debug info {% endcomment %}
  <div style="display:none">
    section.settings: {{ section.settings | json }}<br>
    dropdown_menu: {{ dropdown_menu | json }}<br>
    mega_menu: {{ mega_menu | json }}<br>
    linklists: {{ linklists | json }}
  </div>

  {%- if dropdown_menu != blank -%}
    {% render 'vertical-dropdown-menu' %}
  {%- endif -%}

  {%- if mega_menu != blank -%}
    {% render 'vertical-mega-menu' %}
  {%- endif -%}

  {%- if dropdown_menu == blank and mega_menu == blank -%}
    <div class="sidebar-warning">
      Please select menus in theme editor
    </div>
  {%- endif -%}
</div>

{% schema %}
{
  "name": "Custom Sidebar",
  "settings": [
    {
      "type": "link_list",
      "id": "dropdown_menu",
      "label": "Dropdown Menu"
    },
    {
      "type": "link_list",
      "id": "mega_menu",
      "label": "Mega Menu"
    }
  ],
  "presets": [
    {
      "name": "Custom Sidebar"
    }
  ]
}
{% endschema %}
