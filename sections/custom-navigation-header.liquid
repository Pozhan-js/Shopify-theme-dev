<!-- 现代化导航栏 - 固定顶部版本 -->
<style>
  /* 主导航容器 - 固定在顶部 */
  .modern-nav-header {
    position: fixed !important;
    top: 48px !important;
    left: 0 !important;
    right: 0 !important;
    width: 100% !important;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.06);
    z-index: 1000 !important;
    backdrop-filter: blur(10px);
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  /* 当公告栏关闭时，导航栏移到顶部 */
  .modern-nav-header.announcement-closed {
    top: 0 !important;
  }

  /* 滚动时的样式变化 */
  .modern-nav-header.scrolled {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
  }

  /* 为页面内容添加顶部间距，避免被固定导航栏遮挡 */
  body {
    padding-top: 0 !important;
    margin-top: 0 !important;
  }

  /* 动态计算页面顶部间距 */
  .page-content-wrapper {
    padding-top: calc(var(--header-height, 90px) + var(--announcement-height, 48px));
    transition: padding-top 0.3s ease;
  }

  .modern-nav-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.2rem 3rem;
    max-width: 1600px;
    margin: 0 auto;
    position: relative;
  }

  /* Logo 区域 - 左对齐 */
  .modern-logo {
    flex-shrink: 0;
    z-index: 1001;
  }

  .modern-logo-link {
    display: block;
    text-decoration: none;
    transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .modern-logo-link:hover {
    transform: scale(1.02);
  }

  .modern-logo-image {
    height: {{ section.settings.logoheight | default: 65 }}px;
    width: auto;
    max-width: 220px;
    object-fit: contain;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
  }

  .modern-logo h2 {
    margin: 0;
    color: #404040;
    font-size: 2rem;
    font-weight: 700;
    -webkit-background-clip: text;
    background-clip: text;
  }

  /* 右侧导航区域 */
  .nav-right-section {
    display: flex;
    align-items: center;
    gap: 3rem;
    margin-left: auto;
  }

  /* 主导航菜单 - 右对齐 */
  .modern-nav-menu {
    display: flex;
    align-items: center;
    gap: 2.8rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .modern-nav-item {
    position: relative;
  }

  .modern-nav-link {
    display: flex;
    align-items: center;
    text-decoration: none;
    color: #2d3748;
    font-weight: 600;
    font-size: 1.05rem;
    padding: 1rem 1.5rem;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    position: relative;
    letter-spacing: 0.3px;
    /* 修复跳动问题：预设透明边框 */
    border-bottom: 2px solid transparent;
  }

  /* 鼠标悬停时移除所有颜色变化效果 */
  .modern-nav-link:hover {
    background: none;
    transform: none;
    box-shadow: none;
    border-bottom-color: transparent;
  }

  /* 功能图标区域 */
  .nav-icons-section {
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .nav-icon-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: none;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    color: #454C5A;
    position: relative;
    padding: 0;
  }

  .nav-icon-button svg {
    width: 24px;
    height: 24px;
    stroke: #454C5A;
    fill: none;
    stroke-width: 1.2;
    stroke-linecap: round;
    stroke-linejoin: round;
    transition: all 0.3s ease;
  }

  .nav-icon-button:hover svg {
    stroke: #2d3748;
    transform: scale(1.1);
  }

  /* 购物车徽章 */
  .cart-badge {
    position: absolute;
    top: -6px;
    right: -6px;
    background: #ff6b35;
    color: white;
    border-radius: 50%;
    width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    font-weight: 700;
    transform: scale(0);
    transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }

  .cart-badge.show {
    transform: scale(1);
  }

  /* 语言切换紧凑版 */
  .compact-language-selector {
    position: relative;
  }

  .compact-language-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: none;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 0;
  }

  .compact-language-toggle:hover {
    transform: scale(1.1);
  }

  .compact-language-flag {
    width: 24px;
    height: 18px;
    border-radius: 3px;
    background-size: cover;
    background-position: center;
    transition: transform 0.3s ease;
  }

  .compact-language-flag.zh,
  .compact-language-flag.zh-CN,
  .compact-language-flag.zh-TW {
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 20"><rect width="30" height="20" fill="%23de2910"/><polygon points="6,2 7.5,6.5 2.5,4 9.5,4 4.5,6.5" fill="%23ffde00"/></svg>');
  }

  .compact-language-flag.en,
  .compact-language-flag.en-US,
  .compact-language-flag.en-GB {
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 20"><rect width="30" height="20" fill="%23012169"/><path d="M0,0 L30,20 M30,0 L0,20" stroke="%23fff" stroke-width="2"/><path d="M15,0 L15,20 M0,10 L30,10" stroke="%23fff" stroke-width="3"/><path d="M15,0 L15,20 M0,10 L30,10" stroke="%23c8102e" stroke-width="2"/></svg>');
  }

  .compact-language-flag.ja,
  .compact-language-flag.ja-JP {
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 20"><rect width="30" height="20" fill="%23fff"/><circle cx="15" cy="10" r="6" fill="%23bc002d"/></svg>');
  }

  .compact-language-dropdown {
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    z-index: 1001;
    min-width: 160px;
    overflow: hidden;
  }

  .compact-language-selector.open .compact-language-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .compact-language-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
    font-size: 0.9rem;
    color: #2F3747;
    font-weight: 500;
  }

  .compact-language-option:hover {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  }

  .compact-language-option.active {
    font-weight: 600;
  }

  /* Shopify 本地化表单样式 */
  .localization-form {
    margin: 0;
    padding: 0;
    width: 100%;
  }

  .localization-form .compact-language-option,
  .localization-form .language-option {
    width: 100%;
    margin: 0;
  }

  /* Dawn主题搜索样式优化 */
  .search-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 1100;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    backdrop-filter: blur(4px);
  }

  .search-modal[open] {
    opacity: 1;
    visibility: visible;
  }

  .search-modal__content {
    position: absolute;
    top: calc(var(--header-height, 90px) + var(--announcement-height, 48px) + 2rem);
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 4rem);
    max-width: 65rem;
    background: white;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    overflow: hidden;
    animation: searchModalSlideIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  @keyframes searchModalSlideIn {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(-20px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0) scale(1);
    }
  }

  .search-modal__form {
    position: relative;
    border-bottom: 1px solid #f1f5f9;
    background: white;
  }

  .search-modal__form .field {
    margin-bottom: 0;
    position: relative;
  }

  .search-modal__form .field__input {
    width: 100%;
    padding: 2rem 6rem 2rem 2.5rem;
    font-size: 1.6rem;
    font-weight: 500;
    border: none;
    background: transparent;
    color: #2d3748;
    outline: none;
    font-family: inherit;
    line-height: 1.5;
  }

  .search-modal__form .field__input::placeholder {
    color: #94a3b8;
    font-weight: 400;
  }

  .search-modal__form .field__input:focus {
    box-shadow: none;
    outline: none;
  }

  .search-modal__form .field__label {
    display: none;
  }

  .search-modal__close-button {
    position: absolute;
    top: 50%;
    right: 2rem;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0.8rem;
    border-radius: 8px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .search-modal__close-button:hover {
    background: rgba(102, 126, 234, 0.1);
  }

  .search-modal__close-button svg {
    width: 1.4rem;
    height: 1.4rem;
    stroke: #64748b;
    stroke-width: 2;
  }

  /* 搜索按钮样式 */
  .search-modal__form .search__button {
    position: absolute;
    top: 50%;
    right: 5rem;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0.8rem;
    border-radius: 8px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .search-modal__form .search__button:hover {
    background: rgba(102, 126, 234, 0.1);
  }

  .search-modal__form .search__button svg {
    width: 1.4rem;
    height: 1.4rem;
    stroke: #64748b;
    stroke-width: 2;
  }

  /* 重置按钮样式 */
  .search-modal__form .reset__button {
    display: none;
  }

  /* 预测搜索结果 */
  .predictive-search {
    max-height: 45rem;
    overflow-y: auto;
    background: white;
  }

  .predictive-search::-webkit-scrollbar {
    width: 6px;
  }

  .predictive-search::-webkit-scrollbar-track {
    background: #f8fafc;
  }

  .predictive-search::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 3px;
  }

  .predictive-search::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }

  /* 加载状态优化 */
  .predictive-search__loading-state {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 3rem 2rem;
    color: #64748b;
    font-size: 0.95rem;
  }

  .predictive-search__loading-state .spinner {
    width: 1.5rem;
    height: 1.5rem;
    margin-right: 0.8rem;
    animation: spin 1s linear infinite;
  }

  .predictive-search__loading-state .spinner circle {
    stroke: #667eea;
    stroke-width: 3;
    stroke-linecap: round;
    fill: none;
    stroke-dasharray: 31.416;
    stroke-dashoffset: 31.416;
    animation: spinCircle 2s ease-in-out infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  @keyframes spinCircle {
    0% {
      stroke-dasharray: 0 31.416;
    }
    50% {
      stroke-dasharray: 15.708 15.708;
    }
    100% {
      stroke-dasharray: 31.416 0;
    }
  }

  /* 搜索结果项样式 */
  .predictive-search__item {
    padding: 1.2rem 2rem;
    border-bottom: 1px solid #f8fafc;
    transition: background-color 0.2s ease;
  }

  .predictive-search__item:hover {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
  }

  .predictive-search__item:last-child {
    border-bottom: none;
  }

  /* 无结果状态 */
  .predictive-search__no-results {
    padding: 3rem 2rem;
    text-align: center;
    color: #64748b;
    font-size: 0.95rem;
  }

  /* 下拉菜单样式 - 调整位置以适应固定导航栏 */
  .modern-mega-menu {
    position: fixed;
    top: 100%;
    left: 0;
    right: 0;
    width: 100vw;
    background: #faf9f7;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    border-radius: 0;
    padding: 3rem 0;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.15s ease-out, visibility 0.15s ease-out, transform 0.15s ease-out;
    z-index: 999;
    border-top: 1px solid #ede8e0;
    transform: translateY(-10px);
    min-height: 200px;
  }

  .modern-nav-item:hover .modern-mega-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
    transition: opacity 0.3s ease-in, visibility 0.3s ease-in, transform 0.3s ease-in;
  }

  /* 为所有导航项显示下拉菜单 */
  .modern-nav-item.has-dropdown:hover .modern-mega-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
    transition: opacity 0.3s ease-in, visibility 0.3s ease-in, transform 0.3s ease-in;
  }

  /* 下拉菜单内容容器 */
  .mega-menu-content {
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 3rem;
  }

  /* 菜单网格布局 */
  .mega-menu-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 2.5rem;
    align-items: start;
  }

  /* 菜单分类列 */
  .mega-menu-category {
    display: flex;
    flex-direction: column;
  }

  /* 主分类标题 */
  .mega-menu-category-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 1.2rem;
    padding-bottom: 0.8rem;
    border-bottom: 2px solid #e2e8f0;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  /* 子分类列表 */
  .mega-menu-subcategories {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
  }

  /* 子分类项目 */
  .mega-menu-subcategory {
    position: relative;
    padding-left: 1rem;
  }

  .mega-menu-subcategory::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 3px;
    height: 0;
    background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
    transition: height 0.3s ease;
    border-radius: 2px;
  }

  .mega-menu-subcategory:hover::before {
    height: 100%;
  }

  .mega-menu-subcategory-link {
    display: block;
    color: #64748b;
    text-decoration: none;
    font-size: 0.95rem;
    font-weight: 500;
    padding: 0.4rem 0;
    transition: all 0.3s ease;
    position: relative;
  }

  .mega-menu-subcategory-link:hover {
    color: #64748b;
    transform: translateX(8px);
  }

  /* 空状态提示 */
  .mega-menu-placeholder {
    grid-column: 1 / -1;
    text-align: center;
    color: #94a3b8;
    font-size: 1.1rem;
    font-weight: 500;
    padding: 2rem;
  }

  /* 现代语言切换器 */
  .modern-localization {
    position: relative;
  }

  .language-selector {
    position: relative;
    display: inline-block;
  }

  .language-toggle {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    padding: 1rem 1.5rem;
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    font-size: 0.95rem;
    font-weight: 600;
    color: #2d3748;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    min-width: 120px;
  }

  .language-toggle:hover {
    border-color: #667eea;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
    transform: translateY(-2px);
  }

  .language-flag {
    width: 24px;
    height: 18px;
    border-radius: 4px;
    background-size: cover;
    background-position: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .language-flag.zh,
  .language-flag.zh-CN,
  .language-flag.zh-TW {
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 20"><rect width="30" height="20" fill="%23de2910"/><polygon points="6,2 7.5,6.5 2.5,4 9.5,4 4.5,6.5" fill="%23ffde00"/></svg>');
  }

  .language-flag.en,
  .language-flag.en-US,
  .language-flag.en-GB {
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 20"><rect width="30" height="20" fill="%23012169"/><path d="M0,0 L30,20 M30,0 L0,20" stroke="%23fff" stroke-width="2"/><path d="M15,0 L15,20 M0,10 L30,10" stroke="%23fff" stroke-width="3"/><path d="M15,0 L15,20 M0,10 L30,10" stroke="%23c8102e" stroke-width="2"/></svg>');
  }

  .language-flag.ja,
  .language-flag.ja-JP {
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 20"><rect width="30" height="20" fill="%23fff"/><circle cx="15" cy="10" r="6" fill="%23bc002d"/></svg>');
  }

  .language-dropdown-icon {
    font-size: 0.7rem;
    transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    opacity: 0.7;
  }

  .language-selector.open .language-dropdown-icon {
    transform: rotate(180deg);
    opacity: 1;
  }

  .language-dropdown {
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    z-index: 1001;
    min-width: 180px;
    overflow: hidden;
  }

  .language-selector.open .language-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .language-option {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.5rem;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
    font-size: 0.95rem;
    color: #2F3747;
    font-weight: 500;
  }

  .language-option:hover {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  }

  .language-option.active {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    color: #667eea;
    font-weight: 600;
  }

  /* 回到顶部按钮 - 固定在屏幕右下角 */
  .back-to-top {
    position: fixed !important;
    bottom: 30px !important;
    right: 30px !important;
    width: 56px !important;
    height: 56px !important;
    background: #C6C7C8 !important;
    border: none !important;
    border-radius: 50% !important;
    cursor: pointer !important;
    display: none !important;
    align-items: center !important;
    justify-content: center !important;
    box-shadow: 0 8px 25px rgba(198, 199, 200, 0.3) !important;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
    z-index: 999 !important;
    opacity: 0 !important;
    visibility: hidden !important;
    transform: translateY(20px) !important;
    backdrop-filter: blur(10px) !important;
    /* 确保按钮基于屏幕定位，不受任何父元素影响 */
    margin: 0 !important;
    padding: 0 !important;
    top: auto !important;
    left: auto !important;
    float: none !important;
    clear: none !important;
    /* 确保不受header容器影响 */
    position: fixed !important;
  }

  .back-to-top.show {
    display: flex !important;
    opacity: 1 !important;
    visibility: visible !important;
    transform: translateY(0) !important;
  }

  .back-to-top.hide {
    opacity: 0 !important;
    visibility: hidden !important;
    transform: translateY(20px) !important;
  }

  .back-to-top:hover {
    transform: translateY(-4px) scale(1.05) !important;
    box-shadow: 0 12px 35px rgba(198, 199, 200, 0.5) !important;
    background: #B0B1B2 !important;
  }

  .back-to-top:active {
    transform: translateY(-2px) scale(0.98) !important;
  }

  .back-to-top svg {
    width: 24px !important;
    height: 24px !important;
    stroke: white !important;
    fill: none !important;
    stroke-width: 2.5 !important;
    stroke-linecap: round !important;
    stroke-linejoin: round !important;
    transition: transform 0.3s ease !important;
  }

  .back-to-top:hover svg {
    transform: translateY(-2px) !important;
  }

  /* 手机端汉堡菜单 */
  .mobile-menu-toggle {
    display: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.8rem;
    z-index: 1002;
    position: relative;
    border-radius: 8px;
    transition: background-color 0.3s ease;
  }

  .mobile-menu-toggle:hover {
    background: rgba(102, 126, 234, 0.1);
  }

  .hamburger-line {
    display: block;
    width: 28px;
    height: 3px;
    background: #2d3748;
    margin: 6px 0;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    border-radius: 2px;
  }

  .mobile-menu-toggle.active .hamburger-line:nth-child(1) {
    transform: rotate(45deg) translate(7px, 7px);
  }

  .mobile-menu-toggle.active .hamburger-line:nth-child(2) {
    opacity: 0;
    transform: scale(0);
  }

  .mobile-menu-toggle.active .hamburger-line:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
  }

  /* 手机端抽屉菜单 */
  .mobile-menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.6);
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    z-index: 1998;
    backdrop-filter: blur(4px);
  }

  .mobile-menu-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .mobile-menu-drawer {
    position: fixed;
    top: 0;
    right: -100vw;
    width: 90vw;
    max-width: 420px;
    height: 100vh;
    background: white;
    box-shadow: -10px 0 40px rgba(0, 0, 0, 0.15);
    transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    z-index: 1999;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 0;
  }

  .mobile-menu-drawer.active {
    right: 0;
  }

  .mobile-menu-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 2rem;
    border-bottom: 2px solid #f1f5f9;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  }

  .mobile-menu-logo {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1a202c;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .mobile-menu-close {
    background: none;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    padding: 0.5rem;
    color: #64748b;
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .mobile-menu-close:hover {
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
  }

  .mobile-nav-content {
    padding: 2rem 0;
  }

  .mobile-nav-item {
    border-bottom: 1px solid #f1f5f9;
  }

  .mobile-nav-link {
    display: block;
    padding: 1.5rem 2rem;
    text-decoration: none;
    color: #2d3748;
    font-weight: 600;
    font-size: 1.1rem;
    transition: all 0.3s ease;
    position: relative;
  }

  .mobile-nav-link::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    transform: scaleY(0);
    transition: transform 0.3s ease;
  }

  .mobile-nav-link:hover::before {
    transform: scaleY(1);
  }

  .mobile-nav-link:hover {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    color: #667eea;
  }

  .mobile-submenu {
    background: #f8fafc;
    padding-left: 1rem;
  }

  .mobile-submenu-item {
    border-bottom: 1px solid #e2e8f0;
  }

  .mobile-submenu-link {
    display: block;
    padding: 1rem 2rem;
    text-decoration: none;
    color: #64748b;
    font-size: 1rem;
    font-weight: 500;
    transition: color 0.3s ease;
  }

  .mobile-submenu-link:hover {
    color: #667eea;
  }

  .mobile-language-section {
    padding: 2rem;
    border-top: 2px solid #f1f5f9;
    margin-top: 2rem;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  }

  .mobile-language-title {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    color: #1a202c;
  }

  .mobile-language-options {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
  }

  /* 防止页面滚动 */
  body.mobile-menu-open {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    overflow: hidden;
  }

  html {
    overflow-x: hidden;
  }

  body {
    overflow-x: hidden;
  }

  /* 响应式设计 */
  @media screen and (max-width: 1200px) {
    .modern-nav-container {
      padding: 1rem 2rem;
    }

    .modern-nav-menu {
      gap: 2.2rem;
    }

    .modern-mega-menu {
      padding: 2.5rem;
    }

    .mega-menu-content {
      padding: 0 2.5rem;
    }

    .mega-menu-grid {
      grid-template-columns: repeat(4, 1fr);
      gap: 2rem;
    }
  }

  @media screen and (max-width: 1024px) {
    .nav-right-section {
      gap: 2rem;
    }

    .modern-nav-menu {
      gap: 2rem;
    }

    .modern-mega-menu {
      padding: 2rem;
    }

    .mega-menu-content {
      padding: 0 2rem;
    }

    .mega-menu-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 1.8rem;
    }
  }

  @media screen and (max-width: 768px) {
    .modern-nav-header {
      top: 43px !important;
    }

    .modern-nav-container {
      padding: 0.8rem 1.2rem;
    }

    .nav-right-section {
      gap: 0.8rem;
    }

    .modern-nav-menu {
      display: none;
    }

    .mobile-menu-toggle {
      display: block;
    }

    .modern-mega-menu {
      display: none;
    }

    /* 移动端Logo尺寸调整 */
    .modern-logo-image {
      height: 45px;
      max-width: 180px;
    }

    /* 移动端功能图标尺寸调整 */
    .nav-icon-button {
      width: 20px;
      height: 20px;
    }

    .nav-icon-button svg {
      width: 20px;
      height: 20px;
    }

    /* 移动端购物车徽章调整 */
    .cart-badge {
      width: 14px;
      height: 14px;
      font-size: 0.6rem;
    }

    /* 移动端汉堡菜单调整 */
    .hamburger-line {
      width: 24px;
      height: 2.5px;
      margin: 5px 0;
    }

    /* 移动端隐藏功能图标，但保留翻译图标 */
    .nav-icons-section .nav-icon-button:not(.compact-language-toggle) {
      display: none;
    }

    .nav-icons-section {
      gap: 0.8rem;
    }

    .mobile-menu-drawer {
      width: 85vw;
    }

    /* 移动端回到顶部按钮调整 */
    .back-to-top {
      bottom: 20px !important;
      right: 20px !important;
      width: 48px !important;
      height: 48px !important;
    }

    .back-to-top svg {
      width: 20px !important;
      height: 20px !important;
    }

    /* 搜索模态框移动端调整 */
    .search-modal__content {
      top: calc(var(--header-height, 80px) + var(--announcement-height, 43px) + 1rem);
      width: calc(100% - 2rem);
      max-width: none;
      border-radius: 12px;
    }

    .search-modal__form .field__input {
      font-size: 1.4rem;
      padding: 1.8rem 5rem 1.8rem 2rem;
    }

    .search-modal__close-button {
      right: 1.5rem;
      padding: 0.6rem;
    }

    .search-modal__close-button svg {
      width: 1.2rem;
      height: 1.2rem;
    }

    .search-modal__form .search__button {
      right: 4rem;
      padding: 0.6rem;
    }

    .search-modal__form .search__button svg {
      width: 1.2rem;
      height: 1.2rem;
    }

    .predictive-search {
      max-height: 35rem;
    }

    .predictive-search__loading-state {
      padding: 2rem 1.5rem;
    }

    .predictive-search__item {
      padding: 1rem 1.5rem;
    }
  }

  @media screen and (max-width: 480px) {
    .modern-nav-header {
      top: 43px !important;
    }

    .modern-nav-container {
      padding: 0.6rem 1rem;
    }

    /* 小屏幕Logo进一步缩小 */
    .modern-logo-image {
      height: 40px;
      max-width: 160px;
    }

    /* 小屏幕功能图标进一步缩小 */
    .nav-icon-button {
      width: 18px;
      height: 18px;
    }

    .nav-icon-button svg {
      width: 18px;
      height: 18px;
    }

    /* 小屏幕购物车徽章调整 */
    .cart-badge {
      width: 12px;
      height: 12px;
      font-size: 0.55rem;
    }

    /* 小屏幕汉堡菜单调整 */
    .hamburger-line {
      width: 22px;
      height: 2px;
      margin: 4px 0;
    }

    .mobile-menu-drawer {
      width: 90vw;
    }

    /* 移动端隐藏功能图标，但保留翻译图标 */
    .nav-icons-section .nav-icon-button:not(.compact-language-toggle) {
      display: none;
    }

    .nav-icons-section {
      gap: 0.6rem;
    }

    /* 搜索模态框小屏幕调整 */
    .search-modal__content {
      top: calc(var(--header-height, 70px) + var(--announcement-height, 43px) + 0.5rem);
      width: calc(100% - 1rem);
      border-radius: 8px;
    }

    .search-modal__form .field__input {
      font-size: 1.3rem;
      padding: 1.5rem 4.5rem 1.5rem 1.5rem;
    }

    .predictive-search {
      max-height: 30rem;
    }
  }
</style>

<header class="modern-nav-header color-{{ section.settings.colorscheme }} gradient" id="mainHeader">
  <div class="modern-nav-container">
    <!-- Logo - 左对齐 -->
    <div class="modern-logo">
      {%- if settings.logo != blank -%}
        <a href="{{ routes.root_url }}" class="modern-logo-link">
          {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
          {{
            settings.logo
            | image_url: width: 440
            | image_tag: class: 'modern-logo-image', alt: logo_alt, loading: 'eager'
          }}
        </a>
      {%- else -%}
        <a href="{{ routes.root_url }}" class="modern-logo-link">
          <h2>{{ shop.name }}</h2>
        </a>
      {%- endif -%}
    </div>

    <!-- 右侧导航区域 -->
    <div class="nav-right-section">
      <!-- 桌面端导航菜单 -->
      <nav class="modern-nav-menu">
        {%- for link in section.settings.menu.links -%}
          <div class="modern-nav-item {% if link.links.size > 0 %}has-dropdown{% elsif link.title contains 'Category' or link.title contains '分类' or link.title contains '产品' or link.title contains 'Products' or link.title contains 'Collections' or link.title contains '系列' %}has-dropdown{% endif %}">
            <a href="{{ link.url }}" class="modern-nav-link">
              {{ link.title }}
            </a>

            {%- comment -%} 下拉菜单内容 {%- endcomment -%}
            {%- if link.links.size > 0
              or link.title contains 'Category'
              or link.title contains '分类'
              or link.title contains '产品'
              or link.title contains 'Products'
              or link.title contains 'Collections'
              or link.title contains '系列'
            -%}
              <div class="modern-mega-menu">
                <div class="mega-menu-content">
                  {%- comment -%} 优先显示当前导航项的子菜单 {%- endcomment -%}
                  {%- if link.links.size > 0 -%}
                    <div class="mega-menu-grid">
                      {%- for childlink in link.links -%}
                        <div class="mega-menu-category">
                          <a href="{{ childlink.url }}" class="mega-menu-category-title">
                            {{ childlink.title }}
                          </a>
                          {%- if childlink.links.size > 0 -%}
                            <div class="mega-menu-subcategories">
                              {%- for grandchildlink in childlink.links -%}
                                <div class="mega-menu-subcategory">
                                  <a href="{{ grandchildlink.url }}" class="mega-menu-subcategory-link">
                                    {{ grandchildlink.title }}
                                  </a>
                                </div>
                              {%- endfor -%}
                            </div>
                          {%- endif -%}
                        </div>
                      {%- endfor -%}
                    </div>
                  {%- else -%}
                    {%- comment -%} 如果没有直接子菜单，显示 main-series-menu 的内容 {%- endcomment -%}
                    {%- assign series_menu = linklists['main-series-menu'] -%}
                    {%- if series_menu and series_menu.links.size > 0 -%}
                      <div class="mega-menu-grid">
                        {%- for series_link in series_menu.links -%}
                          <div class="mega-menu-category">
                            <a href="{{ series_link.url }}" class="mega-menu-category-title">
                              {{ series_link.title }}
                            </a>
                            {%- if series_link.links.size > 0 -%}
                              <div class="mega-menu-subcategories">
                                {%- for series_childlink in series_link.links -%}
                                  <div class="mega-menu-subcategory">
                                    <a href="{{ series_childlink.url }}" class="mega-menu-subcategory-link">
                                      {{ series_childlink.title }}
                                    </a>
                                  </div>
                                {%- endfor -%}
                              </div>
                            {%- endif -%}
                          </div>
                        {%- endfor -%}
                      </div>
                    {%- else -%}
                      <div class="mega-menu-placeholder">请在后台创建名为 "main-series-menu" 的菜单来显示分类内容</div>
                    {%- endif -%}
                  {%- endif -%}
                </div>
              </div>
            {%- endif -%}
          </div>
        {%- endfor -%}
      </nav>

      <!-- 功能图标区域 -->
      <div class="nav-icons-section">
        <!-- 搜索图标 -->
        <button class="nav-icon-button" onclick="openSearchModal()" aria-label="搜索">
          <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1758852131307" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4254" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M935.8 882.9c8 9.3 12 19.6 12 31 0 12.6-4.5 23.5-13.5 32.5-8.5 8.8-20.3 13.7-32.5 13.5-5.3 0-10.5-0.9-15.5-2.5s-9.5-4.1-13.5-7.4l-5-4-247.1-249c-59.5 42-125.8 62.9-199.2 62.9-7.3 0-14.8-0.3-22.4-1-7.6-0.6-15.1-1.6-22.6-3-50.8-5.8-99.5-23.6-142.1-52-46.7-30-84.1-69.6-112-118.9-13.5-23-24.1-47.5-31.5-72.9-7.7-25.7-12.3-52.2-14-79-1.6-26.8-0.1-53.6 4.5-80 6.7-42.6 21.6-83.6 44-120.4 22.2-37.1 51.5-69.5 86-95.5 29.3-23.3 62.2-41.3 98.5-54 35.8-12.6 73.6-19 111.6-19 16 0 31.4 1 46.1 3 39.4 5.3 77.1 17.3 113 35.9 35.4 18.2 67.2 42.5 94.1 72 31.3 32.7 55.1 71.3 71.6 116 16.3 44.7 23.5 90 21.5 136-2.7 76.6-29 145.7-79.1 207L936.9 883h-1.1zM715.7 426c2.2-41-4.6-81.9-20-120-8.7-23.4-20.5-45.6-35.1-65.9-14.7-20.6-31.8-39.2-51.5-55.5-19.3-16.2-40.7-29.8-63.6-40.5-48.7-22.6-102.7-31.2-156-24.9-3 0-6 0.3-9 1l-6 1c-42.6 6.6-83.2 22.9-118.6 47.5-35.6 24.2-65.2 56.1-86.5 93.5-24.6 40.7-38.2 86-40.6 136-2.4 50 6.8 96.4 27.5 139 17.3 38.6 43.2 72.7 75.5 99.9 32 27.5 69.8 47.7 110.5 59 42.7 12 85.7 14.4 129.1 7 22.8-4 44.9-10.7 66-20 21-9.2 41-20.7 59.6-34.5 18.5-13.7 35.2-29.5 50.1-47 15-17.7 27.5-36.8 37.6-57.5 18.6-36.7 29.1-77 31-118.1z m0 0" p-id="4255" fill="#474C59"></path></svg>
        </button>

        <!-- 个人中心图标 -->
        <a href="{{ routes.account_url }}" class="nav-icon-button" aria-label="个人中心">
         <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1758852481936" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6124" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M512 87.04c-136.704 0-247.808 111.104-247.808 247.808 0 98.816 58.368 184.32 142.336 223.744-155.136 45.568-268.8 188.928-268.8 358.912 0 10.752 8.704 19.456 19.456 19.456 10.752 0 19.456-8.704 19.456-19.456 0-184.832 150.528-335.36 335.36-335.36 136.704 0 247.808-111.104 247.808-247.808S648.704 87.04 512 87.04z m0 456.192c-115.2 0-208.384-93.696-208.384-208.384 0-115.2 93.696-208.384 208.384-208.384 115.2 0 208.384 93.696 208.384 208.384 0 114.688-93.184 208.384-208.384 208.384z m226.816 76.8c-8.704-6.656-20.992-5.12-27.648 3.584-6.656 8.704-5.12 20.992 3.584 27.648 83.968 64 132.096 161.28 132.096 266.752 0 10.752 8.704 19.456 19.456 19.456 10.752 0 19.456-8.704 19.456-19.456 0.512-118.272-53.248-226.816-146.944-297.984z" fill="#454C5A" p-id="6125"></path></svg>
        </a>

        <!-- 购物车图标 -->
        <a href="{{ routes.cart_url }}" class="nav-icon-button" aria-label="购物车" id="cartIcon">
        <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1758852533574" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7204" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M831.398957 788.813913c-47.037217 0-85.170087 38.13287-85.170087 85.170087 0 47.037217 38.13287 85.170087 85.170087 85.170087s85.170087-38.13287 85.170087-85.170087C916.569043 826.946783 878.436174 788.813913 831.398957 788.813913zM831.398957 916.569043c-23.529739 0-42.585043-19.055304-42.585043-42.585043s19.055304-42.585043 42.585043-42.585043 42.585043 19.055304 42.585043 42.585043S854.906435 916.569043 831.398957 916.569043zM384.24487 788.813913c-47.037217 0-85.170087 38.13287-85.170087 85.170087 0 47.037217 38.13287 85.170087 85.170087 85.170087 47.037217 0 85.170087-38.13287 85.170087-85.170087C469.414957 826.946783 431.282087 788.813913 384.24487 788.813913zM384.24487 916.569043c-23.529739 0-42.585043-19.055304-42.585043-42.585043s19.055304-42.585043 42.585043-42.585043 42.585043 19.055304 42.585043 42.585043S407.752348 916.569043 384.24487 916.569043zM953.165913 557.278609c0 0 48.573217-278.238609 48.573217-279.507478 0-47.037217-38.13287-85.170087-85.170087-85.170087L201.371826 192.601043 188.638609 125.68487C178.109217 90.579478 145.942261 64.845913 107.430957 64.845913l-63.888696 0C31.788522 64.845913 22.26087 74.373565 22.26087 86.127304c0 11.776 9.527652 21.303652 21.303652 21.303652l63.888696 0c20.413217 0 37.420522 14.380522 41.583304 33.52487l93.718261 531.545043c0.400696 3.027478 2.470957 11.820522 2.470957 11.820522 9.616696 33.636174 39.134609 59.169391 75.152696 61.885217l596.190609 0c11.753739 0 21.303652-9.527652 21.303652-21.281391 0-11.776-9.549913-21.303652-21.303652-21.303652L326.745043 703.621565c-19.366957 0-35.528348-13.022609-40.71513-30.72l-9.594435-54.450087 595.411478 0C910.491826 618.451478 942.770087 592.562087 953.165913 557.278609zM268.933565 575.866435 208.873739 235.186087l707.695304 0c23.529739 0 42.585043 19.055304 42.585043 42.585043 0 7.791304-46.83687 268.087652-46.83687 268.087652-5.409391 17.341217-21.348174 29.985391-40.470261 29.985391L268.933565 575.844174z" fill="#454C5A" p-id="7205"></path></svg>
          <span class="cart-badge" id="cartBadge">{{ cart.item_count }}</span>
        </a>

        <!-- Shopify 语言切换器 - 紧凑版 -->
        <div class="compact-language-selector" id="compactLanguageSelector">
          <button
            class="nav-icon-button compact-language-toggle"
            onclick="toggleCompactLanguageDropdown()"
            aria-label="切换语言"
          >
            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1758853750029" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19206" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M381.0304 85.2992H214.2208c-86.2208 0-128.8704 42.6496-128.8704 128.8704v167.2192c0 87.9104 42.6496 130.56 128.8704 128.4608H381.44C469.3504 511.9488 512 469.2992 509.952 380.928V214.1696C512 127.9488 469.3504 85.2992 381.0304 85.2992z m3.4304 331.1104c-29.0304 0-57.1904-11.1104-80.64-30.72-26.4704 19.2-58.4704 30.72-93.0304 30.72a32.256 32.256 0 0 1-32-32 32.256 32.256 0 0 1 32-32c43.52 0 79.7696-29.9008 93.0304-70.8608H210.7904a32.256 32.256 0 0 1-32-32 32.256 32.256 0 0 1 32-32h55.04a31.9488 31.9488 0 0 1 31.5904-28.9792c16.64 0 29.8496 12.8 31.5392 28.9792H384a31.9488 31.9488 0 1 1 0 64h-14.08c-3.84 20.48-11.9296 39.68-22.5792 57.1904 11.52 8.5504 23.8592 13.6704 37.12 13.6704a32.256 32.256 0 0 1 32 32 32.256 32.256 0 0 1-32 32zM384 970.6496c-182.1696 0-330.6496-148.48-330.6496-330.6496a32.256 32.256 0 0 1 32-32 32.256 32.256 0 0 1 32 32 267.1616 267.1616 0 0 0 206.08 259.84l-11.52-19.2a32.0512 32.0512 0 1 1 55.04-32.8704l44.8 74.7008a31.7952 31.7952 0 0 1 0.4096 32 33.3312 33.3312 0 0 1-28.16 16.1792zM938.7008 415.9488a32.256 32.256 0 0 1-32-32 267.1616 267.1616 0 0 0-206.08-259.84l11.52 19.2a32.0512 32.0512 0 1 1-55.04 32.8704l-44.8-74.6496a31.744 31.744 0 0 1-0.4608-32 33.3312 33.3312 0 0 1 28.16-16.2304c182.2208 0 330.7008 148.48 330.7008 330.6496a32.256 32.256 0 0 1-32 32zM721.92 505.6a216.7808 216.7808 0 1 0 0 433.5616 216.7808 216.7808 0 0 0 0-433.5616z m105.7792 319.5904a32.1536 32.1536 0 0 1-43.0592-14.5408l-7.2704-14.4896h-110.5408l-7.2192 14.4896a32.1024 32.1024 0 0 1-28.5696 17.5104 32.6144 32.6144 0 0 1-14.08-3.4304 32.5632 32.5632 0 0 1-14.5408-43.0592l91.3408-182.2208a32.4608 32.4608 0 0 1 28.5696-17.4592c11.9296 0 23.04 6.8096 28.5696 17.92l91.3408 182.1696a32.5632 32.5632 0 0 1-14.5408 43.1104z" fill="#454C5A" p-id="19207"></path><path d="M698.88 732.16h46.5408l-23.5008-46.4384-23.04 46.4896z" fill="#454C5A" p-id="19208"></path></svg>
          </button>
          <div class="compact-language-dropdown" id="compactLanguageDropdown">
            {%- comment -%} 使用 Shopify 官方 localization 表单 {%- endcomment -%}
            {%- form 'localization', id: 'HeaderLanguageFormDesktop', class: 'localization-form' -%}
              {%- if localization.available_languages.size > 1 -%}
                {%- for language in localization.available_languages -%}
                  <button
                    type="submit"
                    name="language_code"
                    value="{{ language.iso_code }}"
                    class="compact-language-option {% if language.iso_code == localization.language.iso_code %}active{% endif %}"
                  >
                    <div class="compact-language-flag {{ language.iso_code }}"></div>
                    <span>
                      {%- case language.iso_code -%}
                        {%- when 'zh', 'zh-CN', 'zh-TW' -%}
                          中文
                        {%- when 'en', 'en-US', 'en-GB' -%}
                          English
                        {%- when 'ja', 'ja-JP' -%}
                          日本語
                        {%- else -%}
                          {{ language.endonym_name }}
                      {%- endcase -%}
                    </span>
                  </button>
                {%- endfor -%}
              {%- else -%}
                {%- comment -%} 如果只有一种语言，显示当前语言 {%- endcomment -%}
                <div class="compact-language-option active">
                  <div class="compact-language-flag {{ localization.language.iso_code }}"></div>
                  <span>
                    {%- case localization.language.iso_code -%}
                      {%- when 'zh', 'zh-CN', 'zh-TW' -%}
                        中文
                      {%- when 'en', 'en-US', 'en-GB' -%}
                        English
                      {%- when 'ja', 'ja-JP' -%}
                        日本語
                      {%- else -%}
                        {{ localization.language.endonym_name }}
                    {%- endcase -%}
                  </span>
                </div>
              {%- endif -%}
            {%- endform -%}
          </div>
        </div>
      </div>

      <!-- 手机端菜单按钮 -->
      <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="打开菜单">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>
    </div>
  </div>

  <!-- Dawn主题搜索模态框 -->
  <details class="search-modal" id="Details-search-1">
    <summary
      class="search-modal__toggle"
      aria-haspopup="dialog"
      aria-label="{{ 'general.search.search' | t }}"
      style="display: none;"
    ></summary>
    <div class="search-modal__content" role="dialog" aria-modal="true" aria-label="{{ 'general.search.search' | t }}">
      <div class="search-modal__form">
        {%- if settings.predictive_search_enabled -%}
          <predictive-search>
        {%- endif -%}
        <form action="{{ routes.search_url }}" method="get" role="search" class="search search-modal__form">
          <div class="field">
            <input
              class="search__input field__input"
              id="Search-In-Modal-1"
              type="search"
              name="q"
              value="{{ search.terms | escape }}"
              placeholder="{{ 'general.search.search' | t }}"
              {%- if settings.predictive_search_enabled -%}
                role="combobox"
                aria-expanded="false"
                aria-owns="predictive-search-results-list"
                aria-controls="predictive-search-results-list"
                aria-haspopup="listbox"
                aria-autocomplete="list"
                autocorrect="off"
                autocomplete="off"
                autocapitalize="off"
                spellcheck="false"
              {%- endif -%}
            >
            <label class="field__label" for="Search-In-Modal-1">{{ 'general.search.search' | t }}</label>
            <input type="hidden" name="options[prefix]" value="last">
            <button type="reset" class="reset__button field__button" aria-label="{{ 'general.search.reset' | t }}">
              <svg class="icon icon-close" aria-hidden="true" focusable="false">
                <use xlink:href="#icon-reset">
              </svg>
            </button>
            <button class="search__button field__button" aria-label="{{ 'general.search.search' | t }}">
              <svg class="icon icon-search" aria-hidden="true" focusable="false">
                <use xlink:href="#icon-search">
              </svg>
            </button>
          </div>

          {%- if settings.predictive_search_enabled -%}
            <div class="predictive-search predictive-search--header" tabindex="-1" data-predictive-search>
              <div class="predictive-search__loading-state">
                <svg
                  aria-hidden="true"
                  focusable="false"
                  class="spinner"
                  viewBox="0 0 66 66"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                </svg>
              </div>
            </div>

            <span class="predictive-search-status visually-hidden" role="status" aria-hidden="true"></span>
          {%- endif -%}
        </form>
        {%- if settings.predictive_search_enabled -%}
          </predictive-search>
        {%- endif -%}
        <button
          type="button"
          class="search-modal__close-button modal__close-button link link--text focus-inset"
          aria-label="{{ 'accessibility.close' | t }}"
        >
          <svg class="icon icon-close" aria-hidden="true" focusable="false">
            <use xlink:href="#icon-close">
          </svg>
        </button>
      </div>
    </div>
  </details>

  <!-- 手机端菜单遮罩 -->
  <div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="closeMobileMenu()"></div>

  <!-- 手机端抽屉菜单 -->
  <div class="mobile-menu-drawer" id="mobileMenuDrawer">
    <div class="mobile-menu-header">
      <div class="mobile-menu-logo">菜单</div>
      <button class="mobile-menu-close" onclick="closeMobileMenu()" aria-label="关闭菜单">×</button>
    </div>

    <nav class="mobile-nav-content">
      {%- for link in section.settings.menu.links -%}
        <div class="mobile-nav-item">
          {%- if link.links.size > 0 -%}
            <div class="mobile-nav-link">{{ link.title }}</div>
            <div class="mobile-submenu">
              {%- for childlink in link.links -%}
                <div class="mobile-submenu-item">
                  <a href="{{ childlink.url }}" class="mobile-submenu-link">{{ childlink.title }}</a>
                </div>
              {%- endfor -%}
            </div>
          {%- else -%}
            <a href="{{ link.url }}" class="mobile-nav-link">{{ link.title }}</a>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </nav>

    <!-- 手机端 Shopify 语言切换 -->
    <div class="mobile-language-section">
      <div class="mobile-language-title">选择语言 / Select Language / 言語選択</div>
      <div class="mobile-language-options">
        {%- form 'localization', id: 'HeaderLanguageFormMobile', class: 'localization-form' -%}
          {%- if localization.available_languages.size > 1 -%}
            {%- for language in localization.available_languages -%}
              <button
                type="submit"
                name="language_code"
                value="{{ language.iso_code }}"
                class="language-option {% if language.iso_code == localization.language.iso_code %}active{% endif %}"
              >
                <div class="language-flag {{ language.iso_code }}"></div>
                <span>
                  {%- case language.iso_code -%}
                    {%- when 'zh', 'zh-CN', 'zh-TW' -%}
                      中文
                    {%- when 'en', 'en-US', 'en-GB' -%}
                      English
                    {%- when 'ja', 'ja-JP' -%}
                      日本語
                    {%- else -%}
                      {{ language.endonym_name }}
                  {%- endcase -%}
                </span>
              </button>
            {%- endfor -%}
          {%- else -%}
            {%- comment -%} 如果只有一种语言，显示当前语言 {%- endcomment -%}
            <div class="language-option active">
              <div class="language-flag {{ localization.language.iso_code }}"></div>
              <span>
                {%- case localization.language.iso_code -%}
                  {%- when 'zh', 'zh-CN', 'zh-TW' -%}
                    中文
                  {%- when 'en', 'en-US', 'en-GB' -%}
                    English
                  {%- when 'ja', 'ja-JP' -%}
                    日本語
                  {%- else -%}
                    {{ localization.language.endonym_name }}
                {%- endcase -%}
              </span>
            </div>
          {%- endif -%}
        {%- endform -%}
      </div>
    </div>
  </div>
</header>

<!-- 回到顶部按钮 - 移到header外部，确保基于屏幕定位 -->
<button class="back-to-top" id="backToTop" onclick="scrollToTop()" aria-label="回到顶部">
  <svg viewBox="0 0 24 24">
    <path d="M18 15l-6-6-6 6"/>
  </svg>
</button>

<!-- 页面内容包装器，用于添加顶部间距 -->
<div class="page-content-wrapper" id="pageContentWrapper">
  <!-- 页面内容将在这里 -->
</div>

<script>
  // 动态计算并设置导航栏高度
  function updateHeaderHeight() {
    const header = document.getElementById('mainHeader');
    const pageContent = document.getElementById('pageContentWrapper');
    
    if (header && pageContent) {
      const headerHeight = header.offsetHeight;
      const announcementClosed = localStorage.getItem('announcementClosed') === 'true';
      const isMobile = window.innerWidth <= 768;
      const isSmallMobile = window.innerWidth <= 480;
      const announcementHeight = announcementClosed ? 0 : (isMobile ? 43 : 48);
      const totalTopOffset = headerHeight + announcementHeight;
      
      // 设置CSS变量，供下拉菜单等元素使用
      document.documentElement.style.setProperty('--header-height', headerHeight + 'px');
      document.documentElement.style.setProperty('--announcement-height', announcementHeight + 'px');
      document.documentElement.style.setProperty('--total-header-offset', totalTopOffset + 'px');
      
      // 设置页面内容顶部间距
      pageContent.style.paddingTop = totalTopOffset + 'px';
      
      // 延迟更新下拉菜单位置，确保导航栏位置已稳定
      setTimeout(() => {
        updateMegaMenuPosition();
      }, 50);
    }
  }

  // 更新下拉菜单位置 - 确保紧挨着导航栏
  function updateMegaMenuPosition() {
    const header = document.getElementById('mainHeader');
    const megaMenus = document.querySelectorAll('.modern-mega-menu');
    
    if (header && megaMenus.length > 0) {
      const headerRect = header.getBoundingClientRect();
      const headerBottom = headerRect.bottom;
      
      megaMenus.forEach(menu => {
        // 使用导航栏的实际底部位置
        menu.style.top = headerBottom + 'px';
      });
    }
  }

  // 检查公告栏状态并更新导航栏位置
  function updateHeaderPosition() {
    const header = document.getElementById('mainHeader');
    if (header) {
      const announcementClosed = localStorage.getItem('announcementClosed') === 'true';
      const isMobile = window.innerWidth <= 768;
      
      if (announcementClosed) {
        header.classList.add('announcement-closed');
        if (isMobile) {
          header.style.top = '0px';
        }
      } else {
        header.classList.remove('announcement-closed');
        if (isMobile) {
          header.style.top = '43px';
        }
      }
      // 更新页面内容的顶部间距
      updateHeaderHeight();
    }
  }

  // 监听 localStorage 变化
  function watchAnnouncementStatus() {
    // 初始检查
    updateHeaderPosition();
    
    // 监听 storage 事件（跨标签页同步）
    window.addEventListener('storage', function(e) {
      if (e.key === 'announcementClosed') {
        updateHeaderPosition();
      }
    });
    
    // 定期检查（防止同页面内的变化）
    setInterval(function() {
      updateHeaderPosition();
    }, 500);
  }

  // 滚动时的导航栏样式变化
  function handleHeaderScroll() {
    const header = document.getElementById('mainHeader');
    if (header) {
      if (window.pageYOffset > 50) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    }
  }

  // Dawn主题搜索控制
  function openSearchModal() {
    const searchModal = document.getElementById('Details-search-1');
    if (searchModal) {
      searchModal.setAttribute('open', '');
      const searchInput = searchModal.querySelector('.search__input');
      if (searchInput) {
        setTimeout(() => {
          searchInput.focus();
        }, 100);
      }
      document.body.classList.add('overflow-hidden');
    }
  }

  function closeSearchModal() {
    const searchModal = document.getElementById('Details-search-1');
    if (searchModal) {
      searchModal.removeAttribute('open');
      document.body.classList.remove('overflow-hidden');
    }
  }

  // 紧凑语言下拉菜单控制
  function toggleCompactLanguageDropdown() {
    const selector = document.getElementById('compactLanguageSelector');
    const dropdown = document.getElementById('compactLanguageDropdown');

    selector.classList.toggle('open');

    // 点击外部关闭
    if (selector.classList.contains('open')) {
      setTimeout(() => {
        document.addEventListener('click', closeCompactLanguageDropdown);
      }, 0);
    } else {
      document.removeEventListener('click', closeCompactLanguageDropdown);
    }
  }

  function closeCompactLanguageDropdown(event) {
    const selector = document.getElementById('compactLanguageSelector');
    if (!selector.contains(event.target)) {
      selector.classList.remove('open');
      document.removeEventListener('click', closeCompactLanguageDropdown);
    }
  }

  // 购物车数量更新
  function updateCartBadge() {
    fetch('/cart.js')
      .then((response) => response.json())
      .then((cart) => {
        const badge = document.getElementById('cartBadge');
        if (cart.item_count > 0) {
          badge.textContent = cart.item_count;
          badge.classList.add('show');
        } else {
          badge.classList.remove('show');
        }
      })
      .catch((error) => console.error('Error updating cart:', error));
  }

  // 手机端菜单控制
  function toggleMobileMenu() {
    const toggle = document.querySelector('.mobile-menu-toggle');
    const overlay = document.getElementById('mobileMenuOverlay');
    const drawer = document.getElementById('mobileMenuDrawer');
    const body = document.body;

    toggle.classList.toggle('active');
    overlay.classList.toggle('active');
    drawer.classList.toggle('active');
    body.classList.toggle('mobile-menu-open');
  }

  function closeMobileMenu() {
    const toggle = document.querySelector('.mobile-menu-toggle');
    const overlay = document.getElementById('mobileMenuOverlay');
    const drawer = document.getElementById('mobileMenuDrawer');
    const body = document.body;

    toggle.classList.remove('active');
    overlay.classList.remove('active');
    drawer.classList.remove('active');
    body.classList.remove('mobile-menu-open');
  }

  // 回到顶部功能
  function scrollToTop() {
    window.scrollTo({
      top: 0,
      behavior: 'smooth',
    });
  }

  // 监听滚动事件，控制回到顶部按钮显示
  function handleScroll() {
    const backToTopBtn = document.getElementById('backToTop');
    if (backToTopBtn) {
      if (window.pageYOffset > 300) {
        backToTopBtn.classList.add('show');
        backToTopBtn.classList.remove('hide');
      } else {
        backToTopBtn.classList.remove('show');
        backToTopBtn.classList.add('hide');
        // 在顶部时完全隐藏按钮
        setTimeout(() => {
          if (!backToTopBtn.classList.contains('show')) {
            backToTopBtn.style.display = 'none';
          }
        }, 300);
      }
    }
    
    // 同时处理导航栏滚动效果
    handleHeaderScroll();
  }

  // ESC 键关闭菜单和弹窗
  document.addEventListener('keydown', function (event) {
    if (event.key === 'Escape') {
      closeMobileMenu();
      closeSearchModal();
      const compactSelector = document.getElementById('compactLanguageSelector');
      if (compactSelector) {
        compactSelector.classList.remove('open');
      }
    }
  });

  // 窗口大小改变时关闭手机菜单并重新计算高度
  window.addEventListener('resize', function () {
    if (window.innerWidth > 768) {
      closeMobileMenu();
    }
    updateHeaderPosition();
    updateHeaderHeight();
  });

  // 页面加载完成后初始化
  document.addEventListener('DOMContentLoaded', function () {
    // 初始化公告栏状态监听
    watchAnnouncementStatus();
    
    // 初始化导航栏高度和下拉菜单位置
    updateHeaderHeight();
    
    // 监听窗口大小变化，重新计算下拉菜单位置
    let resizeTimeout;
    window.addEventListener('resize', function() {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(function() {
        updateHeaderHeight();
        // 额外确保下拉菜单位置正确
        setTimeout(updateMegaMenuPosition, 100);
      }, 100);
    });
    
    // 监听滚动事件，实时更新下拉菜单位置（针对固定定位）
    window.addEventListener('scroll', function() {
      updateMegaMenuPosition();
    });
    
    // 初始化购物车徽章
    const cartBadge = document.getElementById('cartBadge');
    if (cartBadge && parseInt(cartBadge.textContent) > 0) {
      cartBadge.classList.add('show');
    }

    // 监听购物车变化（如果有相关事件）
    document.addEventListener('cart:updated', updateCartBadge);

    // 初始化Dawn搜索功能
    const searchModal = document.getElementById('Details-search-1');
    if (searchModal) {
      // 监听搜索模态框关闭
      const closeButton = searchModal.querySelector('.search-modal__close-button');
      if (closeButton) {
        closeButton.addEventListener('click', closeSearchModal);
      }

      // 点击背景关闭
      searchModal.addEventListener('click', function (e) {
        if (e.target === searchModal) {
          closeSearchModal();
        }
      });

      // 点击搜索模态框内容外部关闭
      document.addEventListener('click', function (e) {
        if (
          searchModal.hasAttribute('open') &&
          !searchModal.querySelector('.search-modal__content').contains(e.target) &&
          !e.target.closest('.nav-icon-button')
        ) {
          closeSearchModal();
        }
      });

      // ESC键关闭
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && searchModal.hasAttribute('open')) {
          closeSearchModal();
        }
      });
    }

    // 为所有内部链接添加平滑滚动
    const links = document.querySelectorAll('a[href^="#"]');
    links.forEach((link) => {
      link.addEventListener('click', function (e) {
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          e.preventDefault();
          const headerHeight = document.getElementById('mainHeader').offsetHeight;
          const targetPosition = target.offsetTop - headerHeight - 20;
          window.scrollTo({
            top: targetPosition,
            behavior: 'smooth',
          });
        }
      });
    });

    // 初始化回到顶部按钮
    const backToTopBtn = document.getElementById('backToTop');
    if (backToTopBtn) {
      // 确保按钮基于屏幕固定定位，不受任何父元素影响
      setTimeout(() => {
        // 强制设置固定定位样式
        backToTopBtn.style.position = 'fixed';
        backToTopBtn.style.bottom = '30px';
        backToTopBtn.style.right = '30px';
        backToTopBtn.style.zIndex = '9999999';

        // 初始检查滚动位置
        handleScroll();
      }, 100);

      // 监听滚动事件
      window.addEventListener('scroll', handleScroll);
    }

    // 监听字体加载完成后重新计算高度
    if (document.fonts) {
      document.fonts.ready.then(() => {
        setTimeout(updateHeaderHeight, 100);
      });
    }
  });

  // 页面完全加载后再次检查高度
  window.addEventListener('load', function() {
    setTimeout(updateHeaderHeight, 200);
  });
</script>

{% schema %}
{
  "name": "固定顶部导航栏",
  "class": "section-header",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "导航菜单"
    },
    {
      "type": "color_scheme",
      "id": "colorscheme",
      "label": "配色方案",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Logo 设置"
    },
    {
      "type": "range",
      "id": "logoheight",
      "min": 45,
      "max": 120,
      "step": 5,
      "unit": "px",
      "label": "Logo 高度",
      "default": 65
    },
    {
      "type": "header",
      "content": "菜单设置"
    },
    {
      "type": "checkbox",
      "id": "showmegamenu",
      "label": "显示大型菜单",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "showmenudescriptions",
      "label": "显示菜单描述",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "showmenu_images",
      "label": "显示菜单图片",
      "default": true
    },
    {
      "type": "header",
      "content": "系列菜单设置"
    },
    {
      "type": "paragraph",
      "content": "请在后台创建名为 'main-series-menu' 的菜单来配置产品分类下拉内容。该菜单将用于显示产品分类相关的导航项下拉菜单。"
    },
    {
      "type": "header",
      "content": "固定导航栏设置"
    },
    {
      "type": "paragraph",
      "content": "导航栏将固定在页面顶部，滚动时保持可见。页面内容会自动添加顶部间距以避免被导航栏遮挡。"
    }
  ],
  "presets": [
    {
      "name": "固定顶部导航栏",
      "category": "Header"
    }
  ]
}
{% endschema %}
