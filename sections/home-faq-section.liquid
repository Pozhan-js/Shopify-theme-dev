{% comment %}
  Home FAQ Section - 常见问题区域
  完全基于 blocks 构建，兼容所有 Shopify 主题版本
  支持分类筛选 + 搜索 + 展开收起
{% endcomment %}

<style>
  .faq-section {
    padding: 4rem 0;
    background: white;
  }

  .faq-container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .faq-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .faq-title {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 1rem;
    color: #1f2937;
  }

  .faq-subtitle {
    font-size: 1.25rem;
    color: #6b7280;
    max-width: 48rem;
    margin: 0 auto;
    line-height: 1.6;
  }

  .faq-search {
    position: relative;
    max-width: 600px;
    margin: 0 auto 2rem;
  }

  .faq-search-input {
    width: 100%;
    padding: 1rem 1rem 1rem 2.5rem;
    border: 1px solid #d1d5db;
    border-radius: 0.75rem;
    font-size: 1.125rem;
    transition: border-color 0.2s;
  }

  .faq-search-input:focus {
    outline: none;
    border-color: #ef4444;
  }

  .faq-search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #9ca3af;
  }

  .faq-categories {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.75rem;
    margin-bottom: 2rem;
  }

  .faq-category {
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 500;
    border: none;
    cursor: pointer;
    background: #f3f4f6;
    color: #4b5563;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.2s;
  }

  .faq-category:hover {
    background: #e5e7eb;
  }

  .faq-category.active {
    background: #ef4444;
    color: white;
  }

  .faq-list {
    max-width: 64rem;
    margin: 0 auto;
  }

  .faq-item {
    border: 1px solid #e5e7eb;
    border-radius: 0.75rem;
    margin-bottom: 1rem;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .faq-item:hover {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .faq-question {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    cursor: pointer;
    background: white;
    transition: background 0.2s;
  }

  .faq-question:hover {
    background: #f9fafb;
  }

  .faq-question-left {
    display: flex;
    align-items: center;
  }

  .faq-number {
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    background: #f3f4f6;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-right: 1rem;
    color: #6b7280;
  }

  .faq-question-text {
    font-weight: 600;
    color: #1f2937;
  }

  .faq-toggle {
    color: #6b7280;
    transition: transform 0.3s ease;
  }

  .faq-item.expanded .faq-toggle {
    transform: rotate(180deg);
  }

  .faq-answer {
    padding: 0 1.5rem;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .faq-item.expanded .faq-answer {
    max-height: 300px;
    padding: 0 1.5rem 1.5rem 1.5rem;
    border-top: 1px solid #f3f4f6;
  }

  .faq-answer-text {
    color: #4b5563;
    line-height: 1.6;
  }

  .no-results {
    text-align: center;
    color: #6b7280;
    padding: 2rem;
  }

  @media (max-width: 768px) {
    .faq-title {
      font-size: 2rem;
    }
    
    .faq-subtitle {
      font-size: 1.125rem;
    }
    
    .faq-categories {
      justify-content: flex-start;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }
    
    .faq-category {
      white-space: nowrap;
    }
  }
</style>

<section class="faq-section">
  <div class="faq-container">
    <!-- 标题 -->
    <div class="faq-header">
      <h2 class="faq-title">{{ section.settings.title }}</h2>
      <p class="faq-subtitle">{{ section.settings.subtitle }}</p>
    </div>

    <!-- 搜索框 -->
    <div class="faq-search">
      <i class="fas fa-search faq-search-icon"></i>
      <input type="text" 
             class="faq-search-input" 
             placeholder="搜索问题..." 
             id="faqSearch">
    </div>

    <!-- 分类按钮 -->
    <div class="faq-categories">
      {% assign has_categories = false %}
      {% for block in section.blocks %}
        {% if block.type == 'category_filter' %}
          {% unless has_categories %}
            {% assign has_categories = true %}
          {% endunless %}
          <button class="faq-category {% if forloop.first %}active{% endif %}" 
                  data-category="{{ block.settings.category_id }}">
            {% if block.settings.icon != blank %}
              <i class="{{ block.settings.icon }}"></i>
            {% endif %}
            {{ block.settings.label }}
          </button>
        {% endif %}
      {% endfor %}

      <!-- 如果没有定义分类，默认显示“全部” -->
      {% if has_categories == false %}
        <button class="faq-category active" data-category="all">全部</button>
      {% endif %}
    </div>

    <!-- FAQ 列表 -->
    <div class="faq-list" id="faqList">
      {% assign index = 1 %}
      {% for block in section.blocks %}
        {% if block.type == 'faq_item' %}
          <div class="faq-item" data-category="{{ block.settings.category }}">
            <div class="faq-question" onclick="toggleFAQ(this)">
              <div class="faq-question-left">
                <div class="faq-number">{{ index }}</div>
                <span class="faq-question-text">{{ block.settings.question }}</span>
              </div>
              <i class="fas fa-chevron-down faq-toggle"></i>
            </div>
            <div class="faq-answer">
              <p class="faq-answer-text">{{ block.settings.answer }}</p>
            </div>
          </div>
          {% assign index = index | plus: 1 %}
        {% endif %}
      {% endfor %}
    </div>

    <div class="no-results" id="noResults" style="display: none;">
      没有找到相关问题，请尝试其他关键词
    </div>
  </div>
</section>

<script>
  let currentCategory = 'all';
  let searchTerm = '';

  function toggleFAQ(element) {
    const faqItem = element.closest('.faq-item');
    faqItem.classList.toggle('expanded');
  }

  function filterFAQs() {
    const faqItems = document.querySelectorAll('.faq-item');
    const noResults = document.getElementById('noResults');
    let visibleCount = 0;

    faqItems.forEach(item => {
      const question = item.querySelector('.faq-question-text').textContent.toLowerCase();
      const answer = item.querySelector('.faq-answer-text').textContent.toLowerCase();
      const category = item.dataset.category || '';
      
      const matchesSearch = !searchTerm || 
                           question.includes(searchTerm.toLowerCase()) || 
                           answer.includes(searchTerm.toLowerCase());
      
      const matchesCategory = currentCategory === 'all' || category === currentCategory;
      
      if (matchesSearch && matchesCategory) {
        item.style.display = 'block';
        visibleCount++;
      } else {
        item.style.display = 'none';
      }
    });

    noResults.style.display = visibleCount === 0 ? 'block' : 'none';
  }

  // 搜索
  document.getElementById('faqSearch').addEventListener('input', function(e) {
    searchTerm = e.target.value.trim();
    filterFAQs();
  });

  // 分类切换
  document.querySelectorAll('.faq-category').forEach(button => {
    button.addEventListener('click', function() {
      document.querySelectorAll('.faq-category').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      currentCategory = this.dataset.category;
      filterFAQs();
    });
  });

  // 初始化
  document.addEventListener('DOMContentLoaded', filterFAQs);
</script>

{% schema %}
{
  "name": "Home FAQ Section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "标题",
      "default": "常见问题"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "副标题",
      "default": "为您整理了最常见的问题和详细解答，如有其他疑问请随时联系我们"
    }
  ],
  "blocks": [
    {
      "type": "category_filter",
      "name": "分类标签",
      "settings": [
        {
          "type": "text",
          "id": "category_id",
          "label": "分类ID",
          "default": "all",
          "info": "如：all, shipping, returns"
        },
        {
          "type": "text",
          "id": "label",
          "label": "显示名称",
          "default": "全部"
        },
        {
          "type": "text",
          "id": "icon",
          "label": "图标类名",
          "default": "fas fa-list",
          "info": "Font Awesome 图标类"
        }
      ]
    },
    {
      "type": "faq_item",
      "name": "问题与答案",
      "settings": [
        {
          "type": "text",
          "id": "category",
          "label": "所属分类ID",
          "default": "all",
          "info": "需与分类标签的ID一致"
        },
        {
          "type": "text",
          "id": "question",
          "label": "问题",
          "default": "配送时间是多久？"
        },
        {
          "type": "textarea",
          "id": "answer",
          "label": "答案",
          "default": "标准配送通常需要3-5个工作日。"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "常见问题",
      "category": "主页模块",
      "settings": {
        "title": "常见问题",
        "subtitle": "为您整理了最常见的问题和详细解答，如有其他疑问请随时联系我们"
      },
      "blocks": [
        {
          "type": "category_filter",
          "settings": {
            "category_id": "all",
            "label": "全部",
            "icon": "fas fa-list"
          }
        },
        {
          "type": "category_filter",
          "settings": {
            "category_id": "shipping",
            "label": "配送",
            "icon": "fas fa-shipping-fast"
          }
        },
        {
          "type": "category_filter",
          "settings": {
            "category_id": "returns",
            "label": "退换货",
            "icon": "fas fa-undo"
          }
        },
        {
          "type": "category_filter",
          "settings": {
            "category_id": "product",
            "label": "产品",
            "icon": "fas fa-box"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "category": "shipping",
            "question": "配送时间是多久？",
            "answer": "标准配送通常需要3-5个工作日，加急配送1-2个工作日。"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "category": "returns",
            "question": "如何申请退换货？",
            "answer": "收到商品后7天内可申请退换货，请保持商品完好并联系客服。"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "category": "product",
            "question": "产品材质是什么？",
            "answer": "我们使用高品质材料制作，具体材质请参考产品详情页。"
          }
        }
      ]
    }
  ]
}
{% endschema %}
