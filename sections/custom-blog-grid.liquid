{% schema %}
{
  "name": "自定义博客网格",
  "tag": "section", 
  "class": "section",
  "settings": [
    {
      "type": "blog",
      "id": "blog",
      "label": "选择博客"
    },
    {
      "type": "select",
      "id": "layout",
      "options": [
        {
          "value": "grid",
          "label": "网格布局"
        },
        {
          "value": "collage",
          "label": "拼贴布局"
        }
      ],
      "default": "grid",
      "label": "布局"
    },
    {
      "type": "checkbox",
      "id": "show_image",
      "default": true,
      "label": "显示图片"
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "default": false,
      "label": "显示日期"
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "default": false,
      "label": "显示作者"
    },
    {
      "type": "checkbox",
      "id": "show_excerpt",
      "default": false,
      "label": "显示摘要"
    },
    {
      "type": "range",
      "id": "articles_per_page",
      "min": 1,
      "max": 12,
      "step": 1,
      "default": 6,
      "label": "每页文章数"
    }
  ],
  "presets": [
    {
      "name": "自定义博客网格"
    }
  ]
}
{% endschema %}

{%- style -%}
  @import url('{{ 'component-article-card.css' | asset_url }}');
  @import url('{{ 'section-main-blog.css' | asset_url }}');
  
  .blog-grid {
    padding: 4rem 0;
  }
  
  .blog-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 3rem;
  }
  
  .blog-tag {
    padding: 0.5rem 1.5rem;
    border-radius: 2rem;
    background: #000;
    color: #fff;
    text-decoration: none;
  }
  
  .blog-tag.active {
    background: #555;
  }
{%- endstyle -%}

{%- paginate blog.articles by section.settings.articles_per_page -%}
  {% assign current_tag = request.path | split: 'tagged/' | last %}
  <div class="blog-grid page-width">
    <div class="blog-grid__header">
      <h1 class="title--primary">
        JOURNAL
      </h1>
      <!--调试：current_tag = {{ current_tag }} -->
      <div class="blog-tags">
        <a href="{{ blog.url }}" class="blog-tag {% if current_tag == '/blogs/news' %}active{% endif %}">ALL</a>
        {% for tag in blog.all_tags %}
          <!--调试：tag = {{ tag }} -->
          {% assign downcased_tag = tag | downcase %}
          <a href="{{ blog.url }}/tagged/{{ tag | handleize }}" class="blog-tag {% if current_tag == downcased_tag %}active{% endif %}">
            {{ tag }}
          </a>
        {% endfor %}
      </div>
    </div>

    <div class="blog-articles {% if section.settings.layout == 'collage' %}blog-articles--collage{% endif %}">
      {%- if current_tag != blank -%}
        {%- assign filtered_articles = blog.articles | where: "tags", current_tag -%}
        <!--调试：filtered_articles = {{ filtered_articles }} -->
        {%- for article in filtered_articles -%}
          <div class="blog-articles__article article">
            {%- render 'custom-article-card',
              article: article,
              show_image: section.settings.show_image,
              show_date: section.settings.show_date,
              show_author: section.settings.show_author,
              show_excerpt: section.settings.show_excerpt
            -%}
          </div>
        {%- endfor -%}
      {%- else -%}
        {%- for article in blog.articles -%}
          <div class="blog-articles__article article">
            {%- render 'custom-article-card',
              article: article,
              show_image: section.settings.show_image,
              show_date: section.settings.show_date,
              show_author: section.settings.show_author,
              show_excerpt: section.settings.show_excerpt
            -%}
          </div>
        {%- endfor -%}
      {%- endif -%}
    </div>

    {%- if paginate.pages > 1 -%}
      {%- render 'pagination', paginate: paginate -%}
    {%- endif -%}
  </div>
{%- endpaginate -%}
