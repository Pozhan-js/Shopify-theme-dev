{%- liquid
  assign autoplay = section.settings.autoplay
  assign autoplay_speed = section.settings.autoplay_speed
-%}

{% schema %}
{
  "name": "图文轮播区块",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "自动轮播",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 1000,
      "max": 10000,
      "step": 500,
      "unit": "ms",
      "label": "轮播速度",
      "default": 3000
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "轮播项",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "标题",
          "default": "区块标题"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "内容",
          "default": "<p>在这里输入您的富文本内容</p>"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "图片"
        },
        {
          "type": "select",
          "id": "image_position",
          "label": "图片位置",
          "options": [
            {
              "value": "left",
              "label": "左侧"
            },
            {
              "value": "right",
              "label": "右侧"
            }
          ],
          "default": "right"
        },
        {
          "type": "range",
          "id": "text_width",
          "min": 30,
          "max": 70,
          "step": 5,
          "unit": "%",
          "label": "文本区域宽度",
          "default": 50
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "图文轮播区块",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}

<style>
  .swiper {
    width: 100%;
    height: 100%;
    padding-bottom: 40px;
  }

  .swiper-slide {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .swiper-pagination {
    position: absolute;
    bottom: 10px;
  }

  .swiper-pagination-bullet {
    width: 12px;
    height: 12px;
    background: #ccc;
    opacity: 1;
  }

  .swiper-pagination-bullet-active {
    background: #000;
  }

  /* 复用图文区块样式 */
  .image-text-container {
    display: flex;
    align-items: center;
    gap: 40px;
    padding: 40px 0;
  }

  .image-content-wrap img {
    width: 100%;
    height: auto;
    border-radius: 8px;
  }

  .section-heading {
    font-size: 2rem;
    margin-bottom: 20px;
  }

  @media screen and (max-width: 749px) {
    .image-text-container {
      flex-direction: column;
      gap: 20px;
    }

    .text-content-wrap,
    .image-content-wrap {
      max-width: 100%;
      width: 100%;
    }
  }
</style>

<div class="swiper">
  <div class="swiper-wrapper">
    {% for block in section.blocks %}
      <div class="swiper-slide">
        <div 
          class="image-text-container"
          style="flex-direction: {% if block.settings.image_position == 'left' %}row-reverse{% else %}row{% endif %}"
        >
          <div class="text-content-wrap" style="width: {{ block.settings.text_width }}% !important; min-width: {{ block.settings.text_width }}% !important; max-width: {{ block.settings.text_width }}% !important;">
            <h2 class="section-heading">{{ block.settings.heading }}</h2>
            <div class="rte">
              {{ block.settings.text }}
            </div>
          </div>

          <div class="image-content-wrap" style="width: calc({{ 100 | minus: block.settings.text_width }}% - 40px);">
            {%- if block.settings.image != blank -%}
              <img
                src="{{ block.settings.image | img_url: '800x' }}"
                alt="{{ block.settings.heading | escape }}"
                loading="lazy"
                width="800"
                height="{{ 800 | divided_by: block.settings.image.aspect_ratio | round }}"
              >
            {%- endif -%}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
  <div class="swiper-pagination"></div>
</div>

{% comment %} theme-check-disable AssetPreload, AssetUrl, ParserBlockingJavaScript, RemoteAsset, MissingTemplate {% endcomment %}
{{ 'swiper-bundle.min.css' | asset_url | stylesheet_tag }}
<script src="{{ 'swiper-bundle.min.js' | asset_url }}" defer></script>
{% comment %} theme-check-enable AssetPreload, AssetUrl, ParserBlockingJavaScript, RemoteAsset, MissingTemplate {% endcomment %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const swiper = new Swiper('.swiper', {
      loop: true,
      autoplay: {{ autoplay | json }} ? {
        delay: {{ autoplay_speed }},
        disableOnInteraction: false,
      } : false,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      effect: 'slide',
      speed: 500
    });
  });
</script>
