<script>
document.addEventListener('DOMContentLoaded', function() {
  const headers = document.querySelectorAll('.expandable-header');
  
  headers.forEach(header => {
    const content = header.nextElementSibling;
    header.addEventListener('click', function() {
      this.classList.toggle('active');
      content.style.maxHeight = content.style.maxHeight ? null : content.scrollHeight + 'px';
    });
  });
});
</script>

{%- style -%}
.expandable-list {
  padding: 20px;
}

.expandable-item {
  margin-bottom: 15px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  overflow: hidden;
}

.expandable-header {
  padding: 16px;
  background: #f8f8f8;
  cursor: pointer;
  font-weight: 500;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.2s ease;
}

.expandable-header:after {
  content: '+';
  font-size: 20px;
}

.expandable-header.active:after {
  content: '-';
}

.expandable-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}

.grid-container {
  display: grid;
  grid-template-columns: repeat({{ section.settings.columns }}, 1fr);
  gap: {{ section.settings.gap }}px;
  padding: 20px;
}

.grid-item {
  position: relative;
  text-align: center;
}

.image-wrapper {
  position: relative;
  width: 100%;
  height: 200px;
}

.grid-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 4px;
}

.image-title {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(255,255,255,0.7);
  padding: 8px 16px;
  border-radius: 20px;
  font-weight: {{ section.settings.title_weight }};
  font-size: {{ section.settings.title_size }}px;
}

.grid-text {
  margin-top: 10px;
  padding: 0 10px;
}

@media (max-width: 768px) {
  .grid-container {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 480px) {
  .grid-container {
    grid-template-columns: 1fr;
  }
}
{%- endstyle -%}

<div class="expandable-list">
  {% for block in section.blocks %}
    <div class="expandable-item">
      <div class="expandable-header">
        {{ block.settings.title }}
      </div>
      <div class="expandable-content">
        <div class="grid-container">
          {% for i in (1..block.settings.item_count) %}
            {% assign image_key = 'image_' | append: i %}
            {% assign text_key = 'text_' | append: i %}
            {% assign title_key = 'title_' | append: i %}
            {% if block.settings[image_key] or block.settings[text_key] %}
              <div class="grid-item">
                {% if block.settings[image_key] %}
                  <div class="image-wrapper">
                    <img src="{{ block.settings[image_key] | img_url: '400x' }}" 
                         class="grid-image"
                         width="400"
                         height="200"
                         alt="{{ block.settings[title_key] | default: 'Image' }}"
                         loading="lazy">
                    {% if block.settings[title_key] %}
                      <div class="image-title">{{ block.settings[title_key] }}</div>
                    {% endif %}
                  </div>
                {% endif %}
                {% if block.settings[text_key] %}
                  <div class="grid-text">{{ block.settings[text_key] }}</div>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  {% endfor %}
</div>

{% schema %}
{
  "name": "可折叠网格列表",
  "settings": [
    {
      "type": "range",
      "id": "columns",
      "min": 1,
      "max": 4,
      "step": 1,
      "label": "每行显示数量",
      "default": 4
    },
    {
      "type": "range",
      "id": "gap",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "网格间距",
      "default": 16
    },
    {
      "type": "header",
      "content": "标题样式"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "标题字号",
      "default": 16
    },
    {
      "type": "select",
      "id": "title_weight",
      "label": "标题粗细",
      "options": [
        {
          "value": "normal",
          "label": "普通"
        },
        {
          "value": "bold",
          "label": "加粗"
        }
      ],
      "default": "bold"
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "分类项",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "分类标题",
          "default": "分类名称"
        },
        {
          "type": "range",
          "id": "item_count",
          "min": 1,
          "max": 12,
          "step": 1,
          "label": "项目数量",
          "default": 4
        },
        {
          "type": "header",
          "content": "网格项1"
        },
        {
          "type": "image_picker",
          "id": "image_1",
          "label": "图片1"
        },
        {
          "type": "text",
          "id": "title_1",
          "label": "标题1",
          "default": "项目1"
        },
        {
          "type": "richtext",
          "id": "text_1",
          "label": "文本1"
        },
        {
          "type": "header",
          "content": "网格项2"
        },
        {
          "type": "image_picker",
          "id": "image_2",
          "label": "图片2"
        },
        {
          "type": "text",
          "id": "title_2",
          "label": "标题2",
          "default": "项目2"
        },
        {
          "type": "richtext",
          "id": "text_2",
          "label": "文本2"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "可折叠网格列表",
      "blocks": [
        {
          "type": "category"
        }
      ]
    }
  ]
}
{% endschema %}
