{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .icon-flow {
    background-color: {{ section.settings.background_color }};
  }

  .icon-flow__container {
    max-width: {{ section.settings.container_width }}px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  .icon-flow__header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .icon-flow__title {
    color: {{ section.settings.heading_color }};
    font-size: 2.5rem;
    margin: 0 0 1rem 0;
    font-weight: bold;
  }

  .icon-flow__subtitle {
    color: {{ section.settings.text_color }};
    font-size: 1.2rem;
    margin: 0;
  }

  .icon-flow__wrapper {
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 800px;
    margin: 0 auto;
  }

  .icon-flow__item {
    position: relative;
    z-index: 2;
    text-align: center;
    flex: 0 0 auto;
  }

  .icon-flow__icon-wrapper {
    position: relative;
    display: inline-block;
    margin-bottom: 1.5rem;
  }

  .icon-flow__icon {
    width: {{ section.settings.icon_size }}px;
    height: {{ section.settings.icon_size }}px;
    color: {{ section.settings.icon_color }};
    display: block;
  }

  .icon-flow__dot {
    position: absolute;
    width: {{ section.settings.dot_size }}px;
    height: {{ section.settings.dot_size }}px;
    background-color: {{ section.settings.dot_color }};
    border-radius: 50%;
    z-index: 3;
  }

  .icon-flow__dot--top-left {
    top: -{{ section.settings.dot_size | divided_by: 2 }}px;
    left: -{{ section.settings.dot_size | divided_by: 2 }}px;
  }

  .icon-flow__dot--top-right {
    top: -{{ section.settings.dot_size | divided_by: 2 }}px;
    right: -{{ section.settings.dot_size | divided_by: 2 }}px;
  }

  .icon-flow__dot--bottom-left {
    bottom: -{{ section.settings.dot_size | divided_by: 2 }}px;
    left: -{{ section.settings.dot_size | divided_by: 2 }}px;
  }

  .icon-flow__dot--bottom-right {
    bottom: -{{ section.settings.dot_size | divided_by: 2 }}px;
    right: -{{ section.settings.dot_size | divided_by: 2 }}px;
  }

  .icon-flow__title-text {
    color: {{ section.settings.item_title_color }};
    font-size: {{ section.settings.item_title_size }}px;
    font-weight: bold;
    margin: 0 0 0.5rem 0;
  }

  .icon-flow__description {
    color: {{ section.settings.text_color }};
    font-size: {{ section.settings.description_size }}px;
    line-height: 1.5;
    margin: 0;
    max-width: 200px;
  }

  .icon-flow__connection {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    z-index: 1;
    pointer-events: none;
  }

  .icon-flow__line {
    position: absolute;
    height: 2px;
    background: transparent;
    border-top: {{ section.settings.line_width }}px dashed {{ section.settings.line_color }};
  }

  .icon-flow__line--horizontal-top {
    top: -{{ section.settings.icon_size | divided_by: 2 }}px;
    left: calc({{ section.settings.icon_size | divided_by: 2 }}px + 20px);
    right: calc({{ section.settings.icon_size | divided_by: 2 }}px + 20px);
  }

  .icon-flow__line--vertical-left {
    width: {{ section.settings.line_width }}px;
    height: {{ section.settings.icon_size | plus: 40 }}px;
    border-top: none;
    border-left: {{ section.settings.line_width }}px dashed {{ section.settings.line_color }};
    top: -{{ section.settings.icon_size | divided_by: 2 | plus: 20 }}px;
    left: calc({{ section.settings.icon_size | divided_by: 2 }}px + 20px);
  }

  .icon-flow__line--vertical-right {
    width: {{ section.settings.line_width }}px;
    height: {{ section.settings.icon_size | plus: 40 }}px;
    border-top: none;
    border-left: {{ section.settings.line_width }}px dashed {{ section.settings.line_color }};
    top: -{{ section.settings.icon_size | divided_by: 2 | plus: 20 }}px;
    right: calc({{ section.settings.icon_size | divided_by: 2 }}px + 20px);
  }

  .icon-flow__line--horizontal-bottom {
    bottom: -{{ section.settings.icon_size | divided_by: 2 }}px;
    left: calc({{ section.settings.icon_size | divided_by: 2 }}px + 20px);
    right: calc({{ section.settings.icon_size | divided_by: 2 }}px + 20px);
  }

  @media screen and (max-width: 749px) {
    .icon-flow__wrapper {
      flex-direction: column;
      gap: 3rem;
    }

    .icon-flow__connection {
      display: none;
    }

    .icon-flow__container {
      padding: 0 1rem;
    }

    .icon-flow__title {
      font-size: 2rem;
    }

    .icon-flow__description {
      max-width: 300px;
    }
  }
{%- endstyle -%}

<div class="icon-flow section-{{ section.id }}-padding">
  <div class="icon-flow__container">
    {%- if section.settings.heading != blank or section.settings.subheading != blank -%}
      <div class="icon-flow__header">
        {%- if section.settings.heading != blank -%}
          <h2 class="icon-flow__title">{{ section.settings.heading }}</h2>
        {%- endif -%}
        {%- if section.settings.subheading != blank -%}
          <p class="icon-flow__subtitle">{{ section.settings.subheading }}</p>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="icon-flow__wrapper">
      <!-- 连接线 -->
      <div class="icon-flow__connection">
        <div class="icon-flow__line icon-flow__line--horizontal-top"></div>
        <div class="icon-flow__line icon-flow__line--vertical-left"></div>
        <div class="icon-flow__line icon-flow__line--vertical-right"></div>
        <div class="icon-flow__line icon-flow__line--horizontal-bottom"></div>
      </div>

      <!-- 第一个图标 -->
      <div class="icon-flow__item">
        <div class="icon-flow__icon-wrapper">
          {%- if section.settings.icon_1 != blank -%}
            <img src="{{ section.settings.icon_1 | img_url: 'master' }}" 
                 alt="{{ section.settings.title_1 }}" 
                 class="icon-flow__icon">
          {%- else -%}
            <svg class="icon-flow__icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
          {%- endif -%}
          <div class="icon-flow__dot icon-flow__dot--top-left"></div>
        </div>
        {%- if section.settings.title_1 != blank -%}
          <h3 class="icon-flow__title-text">{{ section.settings.title_1 }}</h3>
        {%- endif -%}
        {%- if section.settings.description_1 != blank -%}
          <p class="icon-flow__description">{{ section.settings.description_1 }}</p>
        {%- endif -%}
      </div>

      <!-- 第二个图标 -->
      <div class="icon-flow__item">
        <div class="icon-flow__icon-wrapper">
          {%- if section.settings.icon_2 != blank -%}
            <img src="{{ section.settings.icon_2 | img_url: 'master' }}" 
                 alt="{{ section.settings.title_2 }}" 
                 class="icon-flow__icon">
          {%- else -%}
            <svg class="icon-flow__icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/>
            </svg>
          {%- endif -%}
        </div>
        {%- if section.settings.title_2 != blank -%}
          <h3 class="icon-flow__title-text">{{ section.settings.title_2 }}</h3>
        {%- endif -%}
        {%- if section.settings.description_2 != blank -%}
          <p class="icon-flow__description">{{ section.settings.description_2 }}</p>
        {%- endif -%}
      </div>

      <!-- 第三个图标 -->
      <div class="icon-flow__item">
        <div class="icon-flow__icon-wrapper">
          {%- if section.settings.icon_3 != blank -%}
            <img src="{{ section.settings.icon_3 | img_url: 'master' }}" 
                 alt="{{ section.settings.title_3 }}" 
                 class="icon-flow__icon">
          {%- else -%}
            <svg class="icon-flow__icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
            </svg>
          {%- endif -%}
          <div class="icon-flow__dot icon-flow__dot--bottom-right"></div>
        </div>
        {%- if section.settings.title_3 != blank -%}
          <h3 class="icon-flow__title-text">{{ section.settings.title_3 }}</h3>
        {%- endif -%}
        {%- if section.settings.description_3 != blank -%}
          <p class="icon-flow__description">{{ section.settings.description_3 }}</p>
        {%- endif -%}
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "图标流程",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "区块标题"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "主标题",
      "default": "流程步骤"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "副标题",
      "default": "简单三步完成"
    },
    {
      "type": "header",
      "content": "第一个图标"
    },
    {
      "type": "image_picker",
      "id": "icon_1",
      "label": "图标图片"
    },
    {
      "type": "text",
      "id": "title_1",
      "label": "标题",
      "default": "第一步"
    },
    {
      "type": "textarea",
      "id": "description_1",
      "label": "描述",
      "default": "完成第一个步骤的详细说明"
    },
    {
      "type": "header",
      "content": "第二个图标"
    },
    {
      "type": "image_picker",
      "id": "icon_2",
      "label": "图标图片"
    },
    {
      "type": "text",
      "id": "title_2",
      "label": "标题",
      "default": "第二步"
    },
    {
      "type": "textarea",
      "id": "description_2",
      "label": "描述",
      "default": "完成第二个步骤的详细说明"
    },
    {
      "type": "header",
      "content": "第三个图标"
    },
    {
      "type": "image_picker",
      "id": "icon_3",
      "label": "图标图片"
    },
    {
      "type": "text",
      "id": "title_3",
      "label": "标题",
      "default": "第三步"
    },
    {
      "type": "textarea",
      "id": "description_3",
      "label": "描述",
      "default": "完成第三个步骤的详细说明"
    },
    {
      "type": "header",
      "content": "布局设置"
    },
    {
      "type": "range",
      "id": "container_width",
      "min": 1000,
      "max": 1600,
      "step": 50,
      "unit": "px",
      "label": "容器最大宽度",
      "default": 1200
    },
    {
      "type": "range",
      "id": "icon_size",
      "min": 60,
      "max": 150,
      "step": 10,
      "unit": "px",
      "label": "图标大小",
      "default": 80
    },
    {
      "type": "header",
      "content": "连接线设置"
    },
    {
      "type": "color",
      "id": "line_color",
      "label": "连接线颜色",
      "default": "#007bff"
    },
    {
      "type": "range",
      "id": "line_width",
      "min": 1,
      "max": 5,
      "step": 1,
      "unit": "px",
      "label": "连接线宽度",
      "default": 2
    },
    {
      "type": "header",
      "content": "圆点设置"
    },
    {
      "type": "color",
      "id": "dot_color",
      "label": "圆点颜色",
      "default": "#007bff"
    },
    {
      "type": "range",
      "id": "dot_size",
      "min": 8,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "圆点大小",
      "default": 12
    },
    {
      "type": "header",
      "content": "颜色设置"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "背景颜色",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "主标题颜色",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "文本颜色",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "图标颜色",
      "default": "#e91e63"
    },
    {
      "type": "color",
      "id": "item_title_color",
      "label": "项目标题颜色",
      "default": "#333333"
    },
    {
      "type": "header",
      "content": "字体设置"
    },
    {
      "type": "range",
      "id": "item_title_size",
      "min": 16,
      "max": 28,
      "step": 2,
      "unit": "px",
      "label": "项目标题字体大小",
      "default": 20
    },
    {
      "type": "range",
      "id": "description_size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "描述字体大小",
      "default": 14
    },
    {
      "type": "header",
      "content": "间距设置"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "顶部间距",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "底部间距",
      "default": 60
    }
  ],
  "presets": [
    {
      "name": "图标流程"
    }
  ]
}
{% endschema %}
