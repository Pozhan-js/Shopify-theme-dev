<!-- Products Grid Section - å¯åå°ç¼–è¾‘çš„äº§å“å±•ç¤º -->
<div class="products-grid-section">
  <div class="section-container">
    <div class="section-top-row section-align-{{ section.settings.layout_alignment }}">
      {% if section.settings.show_title %}
        <div class="section-header">
          <h2 class="section-title" style="color: {{ section.settings.title_color }};">
            {{ section.settings.title | default: 'å…¨éƒ¨å•†å“' }}
          </h2>
          {% if section.settings.subtitle != blank %}
            <p class="section-subtitle">{{ section.settings.subtitle }}</p>
          {% endif %}
        </div>
      {% endif %}

      {% if section.settings.enable_difficulty_filter %}
        <div class="difficulty-filter">
          <label class="filter-label">æŒ‰éš¾åº¦ç­›é€‰ï¼š</label>
          <div class="filter-buttons">
            <button class="filter-btn active" data-difficulty="all">å…¨éƒ¨</button>
            <button class="filter-btn" data-difficulty="easy">ç®€å•</button>
            <button class="filter-btn" data-difficulty="medium">ä¸­ç­‰</button>
            <button class="filter-btn" data-difficulty="hard">å›°éš¾</button>
          </div>
        </div>
      {% endif %}
    </div>

    {% assign products_to_show = section.settings.products_per_page | default: 20 %}
    {% assign collection_handle = section.settings.collection | default: 'all' %}
    {% assign target_collection = collections[collection_handle] %}

    {% if target_collection and target_collection.products.size > 0 %}
      <div
        class="products-grid"
        style="grid-template-columns: repeat(auto-fill, minmax({{ section.settings.product_width }}px, 1fr));"
        data-difficulty-filter="all"
      >
        {% for product in target_collection.products limit: products_to_show %}
          {% assign difficulty = 'easy' %}
          {% if product.variants.size > 0 %}
            {% assign first_variant = product.variants.first %}
            {% assign option1_value = first_variant.option1 | default: '' %}
            {% assign numeric_value = 1 %}
            {% if option1_value contains '1' %}
              {% assign numeric_value = 1 %}
            {% elsif option1_value contains '2' %}
              {% assign numeric_value = 2 %}
            {% elsif option1_value contains '3' %}
              {% assign numeric_value = 3 %}
            {% elsif option1_value contains '4' %}
              {% assign numeric_value = 4 %}
            {% elsif option1_value contains '5' %}
              {% assign numeric_value = 5 %}
            {% else %}
              {% assign numeric_value = 1 %}
            {% endif %}
            {% case numeric_value %}
              {% when 1, 2 %}
                {% assign difficulty = 'easy' %}
              {% when 3 %}
                {% assign difficulty = 'medium' %}
              {% when 4, 5 %}
                {% assign difficulty = 'hard' %}
              {% else %}
                {% assign difficulty = 'easy' %}
            {% endcase %}
          {% endif %}
          <div class="product-card" data-difficulty="{{ difficulty }}">
            <div class="product-image-container">
              <a href="{{ product.url }}" class="product-link">
                {% if product.featured_image %}
                  <img
                    src="{{ product.featured_image | image_url: width: 220, height: 220, crop: 'center' }}"
                    alt="{{ product.title }}"
                    class="product-image"
                    loading="lazy"
                    width="220"
                    height="220"
                  >
                {% else %}
                  <div class="placeholder-image">
                    <span>ğŸ¥</span>
                  </div>
                {% endif %}
              </a>
              {% if section.settings.show_difficulty_badge %}
                <div class="difficulty-badge difficulty-{{ difficulty }}">
                  {% case difficulty %}
                    {% when 'easy' -%}
                      ç®€å•
                    {% when 'medium' -%}
                      ä¸­ç­‰
                    {% when 'hard' -%}
                      å›°éš¾
                    {% else -%}
                      ç®€å•
                  {% endcase %}
                </div>
              {% endif %}
            </div>

            <div class="product-info">
              <h3 class="product-title">
                <a href="{{ product.url }}">{{ product.title | default: 'å•†å“åç§°' }}</a>
              </h3>

              {% if section.settings.show_add_to_cart %}
                <a href="{{ product.url }}" class="view-product-btn">
                  {{ section.settings.add_to_cart_text | default: 'æŸ¥çœ‹è¯¦æƒ…' }}
                </a>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>

      {% if section.settings.show_view_more and target_collection.products.size > products_to_show %}
        <div class="view-more">
          <a href="{{ target_collection.url }}" class="view-more-btn">
            {{ section.settings.view_more_text | default: 'æŸ¥çœ‹æ›´å¤šå•†å“' }}
          </a>
        </div>
      {% endif %}
    {% else %}
      <div class="empty-state">
        <div class="empty-icon">ğŸ¥</div>
        <h3>{{ section.settings.empty_title | default: 'æš‚æ— å•†å“' }}</h3>
        <p>{{ section.settings.empty_message | default: 'æˆ‘ä»¬æ­£åœ¨ä¸Šæ¶æ›´å¤šç¾å‘³å•†å“ï¼Œæ•¬è¯·æœŸå¾…ï¼' }}</p>
        {% if section.settings.show_empty_button %}
          <a href="{{ section.settings.empty_button_link | default: '/' }}" class="back-home-btn">
            {{ section.settings.empty_button_text | default: 'è¿”å›é¦–é¡µ' }}
          </a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>

<style>
  .products-grid-section {
    padding: 40px 20px;
  }

  .section-container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .section-top-row {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 8px;
    flex-wrap: wrap;
    gap: 20px;
  }

  .section-header {
    margin-bottom: 0;
  }

  .section-header {
    text-align: center;
    margin-bottom: 40px;
  }

  .section-title {
    font-size: 32px;
    font-weight: 600;
  }

  .section-subtitle {
    font-size: 16px;
    color: #666;
  }

  .products-grid {
    display: grid;
    gap: 20px;
  }

  .product-card {
    background: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .product-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
  }

  .product-image-container {
    position: relative;
    padding-bottom: 100%;
    overflow: hidden;
    background: #fafafa;
  }

  .product-link {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: block;
  }

  .product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.2s ease;
  }

  .product-card:hover .product-image {
    transform: scale(1.03);
  }

  .placeholder-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f5f5f5;
    color: #d8a26c;
    font-size: 24px;
  }

  .product-info {
    padding: 12px;
  }

  .product-title {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 8px;
    line-height: 1.3;
    height: 36px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .product-title a {
    color: #333;
    text-decoration: none;
  }

  .product-title a:hover {
    color: #d8a26c;
  }

  .view-product-btn {
    display: block;
    width: 100%;
    padding: 8px 12px;
    background: #8b4513;
    color: white;
    text-align: center;
    text-decoration: none;
    border-radius: 4px;
    font-size: 13px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  .view-product-btn:hover {
    background: #654321;
  }

  .view-more {
    text-align: center;
    margin-top: 40px;
  }

  .view-more-btn {
    display: inline-block;
    padding: 12px 30px;
    background: #d8a26c;
    color: white;
    text-decoration: none;
    border-radius: 20px;
    font-size: 14px;
    transition: background-color 0.2s ease;
  }

  .view-more-btn:hover {
    background: #c6925a;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
  }

  .empty-icon {
    font-size: 48px;
    margin-bottom: 16px;
  }

  .empty-state h3 {
    font-size: 20px;
    color: #333;
    margin-bottom: 8px;
  }

  .empty-state p {
    color: #666;
    margin-bottom: 16px;
  }

  .back-home-btn {
    display: inline-block;
    padding: 10px 24px;
    background: #d8a26c;
    color: white;
    text-decoration: none;
    border-radius: 20px;
    font-size: 14px;
    transition: background-color 0.2s ease;
  }

  .back-home-btn:hover {
    background: #c6925a;
  }

  .section-top-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
    flex-wrap: wrap;
    gap: 20px;
  }

  .section-align-left {
    justify-content: space-between;
  }

  .section-align-center {
    justify-content: center;
    text-align: center;
  }

  .section-align-right {
    justify-content: space-between;
    flex-direction: row-reverse;
  }

  .section-header {
    margin-bottom: 0;
    text-align: left;
  }

  .section-align-center .section-header {
    text-align: center;
  }

  .section-align-right .section-header {
    text-align: right;
  }

  .difficulty-filter {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
    margin-bottom: 0;
    white-space: nowrap;
  }

  .filter-label {
    font-size: 16px;
    font-weight: 500;
    color: #333;
  }

  .filter-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .filter-btn {
    padding: 8px 16px;
    border: 1px solid #ddd;
    background: white;
    color: #666;
    border-radius: 20px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .filter-btn:hover {
    border-color: #d8a26c;
    color: #d8a26c;
  }

  .filter-btn.active {
    background: #d8a26c;
    border-color: #d8a26c;
    color: white;
  }

  .difficulty-badge {
    position: absolute;
    top: 8px;
    right: 8px;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 500;
    color: white;
    z-index: 1;
  }

  .difficulty-easy {
    background: #4caf50;
  }

  .difficulty-medium {
    background: #ff9800;
  }

  .difficulty-hard {
    background: #f44336;
  }

  .product-card[data-difficulty] {
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  .product-card.hidden {
    opacity: 0;
    transform: scale(0.8);
    pointer-events: none;
  }

  @media (max-width: 768px) {
    .products-grid-section {
      padding: 30px 15px;
    }

    .section-top-row {
      flex-direction: column;
      align-items: flex-start;
      gap: 15px;
    }

    .section-align-center {
      align-items: center;
      text-align: center;
    }

    .section-align-right {
      align-items: flex-start;
      text-align: left;
    }

    .section-header {
      text-align: left !important;
    }

    .section-align-center .section-header {
      text-align: center !important;
    }

    .section-align-right .section-header {
      text-align: right !important;
    }

    .difficulty-filter {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }

    .section-title {
      font-size: 28px;
    }

    .section-subtitle {
      font-size: 14px;
    }

    .products-grid {
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)) !important;
      gap: 15px;
    }

    .product-info {
      padding: 10px;
    }

    .product-title {
      font-size: 13px;
      height: 32px;
    }

    .current-price {
      font-size: 14px;
    }

    .view-product-btn {
      font-size: 12px;
      padding: 6px 10px;
    }

    .filter-label {
      font-size: 14px;
    }

    .filter-buttons {
      gap: 6px;
    }

    .filter-btn {
      padding: 6px 12px;
      font-size: 12px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const filterSection = document.querySelector('.products-grid-section');
    if (!filterSection) return;

    const filterButtons = filterSection.querySelectorAll('.filter-btn');
    const productCards = filterSection.querySelectorAll('.product-card[data-difficulty]');
    const productsGrid = filterSection.querySelector('.products-grid');

    if (!filterButtons.length || !productCards.length) return;

    filterButtons.forEach((button) => {
      button.addEventListener('click', function () {
        const selectedDifficulty = this.getAttribute('data-difficulty');

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        filterButtons.forEach((btn) => btn.classList.remove('active'));
        this.classList.add('active');

        // æ›´æ–°ç½‘æ ¼ç­›é€‰çŠ¶æ€
        productsGrid.setAttribute('data-difficulty-filter', selectedDifficulty);

        // ç­›é€‰äº§å“
        productCards.forEach((card) => {
          const cardDifficulty = card.getAttribute('data-difficulty');

          if (selectedDifficulty === 'all' || cardDifficulty === selectedDifficulty) {
            card.classList.remove('hidden');
          } else {
            card.classList.add('hidden');
          }
        });
      });
    });
  });
</script>

{% schema %}
{
  "name": "äº§å“ç½‘æ ¼å±•ç¤º",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "æ ‡é¢˜",
      "default": "All products"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "å‰¯æ ‡é¢˜"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "æ ‡é¢˜é¢œè‰²",
      "default": "#D8A26C"
    },
    {
      "type": "select",
      "id": "layout_alignment",
      "label": "æ ‡é¢˜å’Œç­›é€‰æ¡ä»¶å¯¹é½æ–¹å¼",
      "options": [
        {
          "value": "left",
          "label": "å·¦å¯¹é½ï¼ˆæ ‡é¢˜å·¦ï¼Œç­›é€‰å³ï¼‰"
        },
        {
          "value": "center",
          "label": "å±…ä¸­å¯¹é½"
        },
        {
          "value": "right",
          "label": "å³å¯¹é½ï¼ˆæ ‡é¢˜å³ï¼Œç­›é€‰å·¦ï¼‰"
        }
      ],
      "default": "left"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "é€‰æ‹©å•†å“é›†åˆ"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "æ¯é¡µæ˜¾ç¤ºå•†å“æ•°é‡",
      "min": 4,
      "max": 48,
      "step": 4,
      "default": 20
    },
    {
      "type": "range",
      "id": "product_width",
      "label": "å•†å“å¡ç‰‡å®½åº¦",
      "min": 160,
      "max": 300,
      "step": 10,
      "default": 200
    },
    {
      "type": "checkbox",
      "id": "show_title",
      "label": "æ˜¾ç¤ºæ ‡é¢˜",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_add_to_cart",
      "label": "æ˜¾ç¤ºæŸ¥çœ‹è¯¦æƒ…æŒ‰é’®",
      "default": true
    },
    {
      "type": "text",
      "id": "add_to_cart_text",
      "label": "æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®æ–‡å­—",
      "default": "æŸ¥çœ‹è¯¦æƒ…"
    },
    {
      "type": "checkbox",
      "id": "show_view_more",
      "label": "æ˜¾ç¤ºæŸ¥çœ‹æ›´å¤šæŒ‰é’®",
      "default": true
    },
    {
      "type": "text",
      "id": "view_more_text",
      "label": "æŸ¥çœ‹æ›´å¤šæŒ‰é’®æ–‡å­—",
      "default": "æŸ¥çœ‹æ›´å¤šå•†å“"
    },
    {
      "type": "checkbox",
      "id": "show_empty_button",
      "label": "æ˜¾ç¤ºç©ºçŠ¶æ€æŒ‰é’®",
      "default": true
    },
    {
      "type": "text",
      "id": "empty_title",
      "label": "ç©ºçŠ¶æ€æ ‡é¢˜",
      "default": "æš‚æ— å•†å“"
    },
    {
      "type": "text",
      "id": "empty_message",
      "label": "ç©ºçŠ¶æ€æ¶ˆæ¯",
      "default": "æˆ‘ä»¬æ­£åœ¨ä¸Šæ¶æ›´å¤šç¾å‘³å•†å“ï¼Œæ•¬è¯·æœŸå¾…ï¼"
    },
    {
      "type": "text",
      "id": "empty_button_text",
      "label": "ç©ºçŠ¶æ€æŒ‰é’®æ–‡å­—",
      "default": "è¿”å›é¦–é¡µ"
    },
    {
      "type": "url",
      "id": "empty_button_link",
      "label": "ç©ºçŠ¶æ€æŒ‰é’®é“¾æ¥",
      "default": "/"
    },
    {
      "type": "checkbox",
      "id": "enable_difficulty_filter",
      "label": "å¯ç”¨éš¾åº¦ç­›é€‰åŠŸèƒ½",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_difficulty_badge",
      "label": "æ˜¾ç¤ºéš¾åº¦å¾½ç« ",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "äº§å“ç½‘æ ¼å±•ç¤º",
      "category": "äº§å“"
    }
  ]
}
{% endschema %}
