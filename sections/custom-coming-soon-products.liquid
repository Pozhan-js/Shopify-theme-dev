{% schema %}
{
  "name": "自定义待发布产品表格",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "文字样式"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "min": 12,
      "max": 36,
      "step": 1,
      "unit": "px",
      "label": "产品名称字体大小",
      "default": 20
    },
    {
      "type": "select",
      "id": "title_font_weight",
      "label": "产品名称字体粗细",
      "options": [
        {
          "value": "400",
          "label": "常规"
        },
        {
          "value": "600",
          "label": "半粗"
        },
        {
          "value": "700",
          "label": "加粗"
        }
      ],
      "default": "600"
    },
    {
      "type": "range",
      "id": "price_font_size",
      "min": 12,
      "max": 36,
      "step": 1,
      "unit": "px",
      "label": "产品价格字体大小",
      "default": 20
    },
    {
      "type": "select",
      "id": "price_font_weight",
      "label": "产品价格字体粗细",
      "options": [
        {
          "value": "400",
          "label": "常规"
        },
        {
          "value": "600",
          "label": "半粗"
        },
        {
          "value": "700",
          "label": "加粗"
        }
      ],
      "default": "400"
    }
  ],
  "presets": [
    {
      "name": "自定义待发布产品表格"
    }
  ]
}
{% endschema %}

{%- style -%}
.coming-soon-table {
  width: 98%;
  font-size: {{ section.settings.title_font_size }}px;
  font-weight: {{ section.settings.title_font_weight }};
  border-spacing: 0!important;
}

.coming-soon-table th {
  text-align: left;
  padding: 1rem;
  font-weight: bold;
  border-bottom: 2px solid #999;
}

.coming-soon-table thead tr {
  border-bottom: 2px solid #999;
}

.coming-soon-table td {
  padding: .5rem;
}

/* 表头hover不变色 */
.coming-soon-table thead tr:hover th {
  color: inherit !important;
}

/* 产品行hover效果 */
.coming-soon-table tbody tr:not(.product-description-row):hover {
  color: #ff4f00;
  cursor: pointer;
}

/* 描述行样式 */
.coming-soon-table .product-description,
.coming-soon-table .product-description:hover {
  color: #999;
  font-weight: normal !important;
}

/* 箭头图标样式 */
.coming-soon-table .col-artno {
  position: relative;
  padding-right: 30px;
}
.coming-soon-table .icon-arrow {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  width: 24px;
  height: 24px;
  stroke: currentColor;
}
.coming-soon-table tbody tr:not(.product-description-row):hover .icon-arrow {
  stroke: #ff4f00;
}

.coming-soon-table .col-date {
  width: 120px;
  min-width: 120px;
}
.coming-soon-table .col-brand {
  width: 150px;
  min-width: 150px;
}
.coming-soon-table .col-product {
  width: 250px;
  min-width: 250px;
}
.coming-soon-table .col-color {
  width: 200px;
  min-width: 200px;
}
.coming-soon-table .col-artno {
  width: 120px;
  min-width: 120px;
}

.coming-soon-table .text-cell {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.4;
} 

.coming-soon-table .text-cell p{
  margin:0!important;
}

@media (max-width: 768px) {
  .coming-soon-table {
    font-size: {{ section.settings.title_font_size | times: 0.8 }}px;
  }
  
  .coming-soon-table th,
  .coming-soon-table td {
    padding: 0.5rem;
  }

  /* 移动端只显示前两列 */
  .coming-soon-table .col-brand,
  .coming-soon-table .col-color,
  .coming-soon-table .col-artno {
    display: none;
  }
  
  /* 调整前两列宽度 */
  .coming-soon-table .col-date {
    width: 100px;
    min-width: 100px;
  }
  .coming-soon-table .col-product {
    width: calc(100% - 100px);
    min-width: auto;
  }
}
{%- endstyle -%}
<!-- debug 产品系列头部信息 {{ section.settings.collection }}-->
<!-- debug page url {{ page.url }}-->
{% comment %} {% assign current_collection = page.url | split: '/' | last %} {% endcomment %}
{% assign current_collection = 'new-items' %}
<!-- debug current_collection {{ current_collection }}-->
{%- assign selected_collection = collections[current_collection] | default: collection -%}
<!-- debug selected_collection.title: {{ selected_collection.title }}-->
<!-- debug selected_collection.description: {{ selected_collection.description }} -->
<!-- debug selected_collection json: {{ selected_collection | json }} -->

{%- if selected_collection -%}
  <div class="collection-header">
    <h2 style="font-weight: {{ section.settings.title_font_weight }}">{{ selected_collection.title }}</h2>
    {% if selected_collection.description != blank %}
      <p>{{ selected_collection.description }}</p>
    {% endif %}
  </div>

  <div class="table-wrapper" style="min-height:30rem">
    <table class="coming-soon-table">
      <thead>
        <tr>
          <th class="col-date">Date</th>
          <th class="col-brand">Brand</th>
          <th class="col-product">Product</th>
          <th class="col-color">Color</th>
          <th class="col-artno">Art.no.</th>
        </tr>
      </thead>
      <tbody>
        {% for product in selected_collection.products %}
          {%- assign color_value = product.options_with_values | where: 'name', 'Color' | first -%}
          <tr class="{% if product.description != blank %}has-description{% endif %}">
            <td class="col-date">
              <span class="text-cell">
                {%- if product.metafields.custom.release_date -%}
                  {{ product.metafields.custom.release_date | date: "%d/%m/%y" }}
                {%- else -%}
                  Coming Soon
                {%- endif -%}
              </span>
            </td>
            <td class="col-brand">
              <span class="text-cell">
                {%- if product.vendor != blank -%}
                  {{ product.vendor }}
                {%- else -%}
                  &nbsp;
                {%- endif -%}
              </span>
            </td>
            <td class="col-product">
              <span class="text-cell">
                {%- if product.title != blank -%}
                  <a href="{{ product.url }}" style="color:inherit;text-decoration:none">{{ product.title }}</a>
                {%- else -%}
                  &nbsp;
                {%- endif -%}
              </span>
            </td>
            <td class="col-color">
              <span class="text-cell">
                {%- if product.metafields.custom.color_description != blank -%}
                  {{ product.metafields.custom.color_description }}
                {%- elsif color_value != blank -%}
                  {{ color_value | join: ', ' }}
                {%- else -%}
                  &nbsp;
                {%- endif -%}
              </span>
            </td>
            <td class="col-artno">
              <span class="text-cell">
                {%- if product.metafields.custom.art_no != blank -%}
                  {{ product.metafields.custom.art_no }}
                {%- elsif product.sku != blank -%}
                  {{ product.sku }}
                {%- else -%}
                  &nbsp;
                {%- endif -%}
              </span>
              <svg class="icon-arrow" viewBox="0 0 24 24">
                <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
              </svg>
            </td>
          </tr>
          {% if product.description != blank %}
          <tr class="product-description-row">
            <td class="col-date"><span class="text-cell"></span></td>
            <td class="col-brand"><span class="text-cell"></span></td>
            <td colspan="3" class="product-description">
              <span class="text-cell">{{ product.description }}</span>
            </td>
          </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>
  </div>
{%- else -%}
  <p>请选择一个产品系列</p>
{%- endif -%}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const rows = document.querySelectorAll('.coming-soon-table tbody tr');
    
    rows.forEach(row => {
      if (row.classList.contains('has-description')) {
        // 带描述的行保持原有展开功能
        row.addEventListener('click', function() {
          const descriptionRow = this.nextElementSibling;
          descriptionRow.classList.toggle('show-description');
        });
      } else {
        // 普通产品行添加跳转功能
        const productLink = row.querySelector('.col-product a');
        if (productLink) {
          row.style.cursor = 'pointer';
          row.addEventListener('click', function(e) {
            if (!e.target.closest('a')) { // 避免与内部链接冲突
              window.location.href = productLink.href;
            }
          });
        }
      }
    });
  });
</script>
