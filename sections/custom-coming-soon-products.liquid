{% schema %}
{
  "name": "自定义待发布产品表格",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "选择产品系列"
    },
    {
      "type": "header",
      "content": "文字样式"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "min": 12,
      "max": 36,
      "step": 1,
      "unit": "px",
      "label": "产品名称字体大小",
      "default": 16
    },
    {
      "type": "select",
      "id": "title_font_weight",
      "label": "产品名称字体粗细",
      "options": [
        {
          "value": "400",
          "label": "常规"
        },
        {
          "value": "600",
          "label": "半粗"
        },
        {
          "value": "700",
          "label": "加粗"
        }
      ],
      "default": "600"
    },
    {
      "type": "range",
      "id": "price_font_size",
      "min": 12,
      "max": 36,
      "step": 1,
      "unit": "px",
      "label": "产品价格字体大小",
      "default": 16
    },
    {
      "type": "select",
      "id": "price_font_weight",
      "label": "产品价格字体粗细",
      "options": [
        {
          "value": "400",
          "label": "常规"
        },
        {
          "value": "600",
          "label": "半粗"
        },
        {
          "value": "700",
          "label": "加粗"
        }
      ],
      "default": "400"
    }
  ],
  "presets": [
    {
      "name": "自定义待发布产品表格"
    }
  ]
}
{% endschema %}

{%- style -%}
.coming-soon-table {
  width: 100%;
  border-collapse: collapse;
  margin: 2rem 0;
  font-size: {{ section.settings.title_font_size }}px;
  font-weight: {{ section.settings.title_font_weight }};
}

.coming-soon-table th {
  text-align: left;
  padding: 1rem;
  font-weight: bold;
  border-bottom: 2px solid #ddd;
}

.coming-soon-table td {
  padding: 1rem;
  border-bottom: 1px solid #eee;
  vertical-align: top;
}

.coming-soon-table tr:hover td {
  color: #ff4f00;
}

.coming-soon-table .product-description {
  font-size: 0.9em;
  color: #999;
  display: none;
  padding: 0.5rem 0;
}

.coming-soon-table .has-description + tr .product-description {
  display: block;
}

.coming-soon-table .icon-arrow {
  float: right;
  width: 16px;
  height: 16px;
}

.coming-soon-table .col-date {
  width: 15%;
}
.coming-soon-table .col-brand {
  width: 20%;
}
.coming-soon-table .col-product {
  width: 30%;
}
.coming-soon-table .col-color {
  width: 20%;
}
.coming-soon-table .col-artno {
  width: 15%;
}

.coming-soon-table .text-cell {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.4;
}

@media (max-width: 768px) {
  .coming-soon-table {
    font-size: {{ section.settings.title_font_size | times: 0.8 }}px;
  }
  
  .coming-soon-table th,
  .coming-soon-table td {
    padding: 0.5rem;
  }
}
{%- endstyle -%}
<!-- debug 产品系列头部信息 {{ section.settings.collection }}-->
<!-- debug page url {{ page.url }}-->
{% assign current_collection = page.url | split: '/' | last %}
<!-- debug current_collection {{ current_collection }}-->
{%- assign selected_collection = collections[current_collection] | default: collection -%}
<!-- debug selected_collection.title: {{ selected_collection.title }}-->
<!-- debug selected_collection.description: {{ selected_collection.description }} -->
<!-- debug selected_collection json: {{ selected_collection | json }} -->

{%- if selected_collection -%}
<div class="collection-header">
  {% if selected_collection %}
    <h2 style="font-weight: {{ section.settings.title_font_weight }}">{{ selected_collection.title }}</h2>
    {% if selected_collection.description != blank %}
      <p>{{ selected_collection.description }}</p>
    {% endif %}
  {% endif %}
</div>

<table class="coming-soon-table">
  <thead>
    <tr>
      <th class="col-date">Date</th>
      <th class="col-brand">Brand</th>
      <th class="col-product">Product</th>
      <th class="col-color">Color</th>
      <th class="col-artno">Art.no.</th>
    </tr>
  </thead>
  <tbody>
    {% for product in selected_collection.products %}
      <tr class="{% if product.description != blank %}has-description{% endif %}">
        <td class="col-date text-cell">
          {% if product.metafields.custom.release_date %}
            {{ product.metafields.custom.release_date | date: "%d/%m/%y" }}
          {% else %}
            Coming Soon
          {% endif %}
        </td>
        <td class="col-brand text-cell">{{ product.vendor }}</td>
        <td class="col-product text-cell">
          {{ product.title }}
          <svg class="icon-arrow" viewBox="0 0 24 24">
            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
          </svg>
        </td>
        <td class="col-color text-cell">
          {% if product.metafields.custom.color_description %}
            {{ product.metafields.custom.color_description }}
          {% else %}
            {{ product.options_with_values | where: 'name', 'Color' | first | join: ', ' }}
          {% endif %}
        </td>
        <td class="col-artno text-cell">
          {{ product.metafields.custom.art_no | default: product.sku }}
        </td>
      </tr>
      {% if product.description != blank %}
        <tr>
          <td colspan="5" class="product-description text-cell">
            {{ product.description | strip_html | truncate: 150 }}
          </td>
        </tr>
      {% endif %}
    {% endfor %}
  </tbody>
</table>
{%- else -%}
  <p>请选择一个产品系列</p>
{%- endif -%}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const rows = document.querySelectorAll('.coming-soon-table tbody tr');
    
    rows.forEach(row => {
      if (!row.classList.contains('has-description')) return;
      
      row.addEventListener('click', function() {
        const descriptionRow = this.nextElementSibling;
        descriptionRow.classList.toggle('show-description');
      });
    });
  });
</script>
