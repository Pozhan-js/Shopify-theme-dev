{%- liquid
  assign blocks = section.blocks
  assign heading = section.settings.heading
  assign description = section.settings.description
-%}

<div class="ritual-steps page-width">
  {%- if heading != blank or description != blank -%}
    <div class="ritual-steps__header">
      {%- if heading != blank -%}
        <h2 class="ritual-steps__heading">{{ heading }}</h2>
      {%- endif -%}
      {%- if description != blank -%}
        <div class="ritual-steps__description">{{ description }}</div>
      {%- endif -%}
    </div>
  {%- endif -%}

  <div class="ritual-steps__container">
    {%- for block in blocks -%}
      <div class="ritual-step" {{ block.shopify_attributes }}>
        <div class="ritual-step__number">Step {{ forloop.index }}</div>
        
        {%- if block.settings.title != blank -%}
          <h3 class="ritual-step__title">{{ block.settings.title }}</h3>
        {%- endif -%}
        
        {%- if block.settings.description != blank -%}
          <div class="ritual-step__description">{{ block.settings.description }}</div>
        {%- endif -%}
        
        {%- if block.settings.image != blank -%}
          <div class="ritual-step__image">
            {%- liquid
              assign image = block.settings.image
              assign image_width = block.settings.image_width
            -%}
            {{
              image
              | image_url: width: image_width
              | image_tag: loading: 'lazy', class: 'ritual-step__image-element'
            }}
          </div>
        {%- endif -%}
        
        {%- if block.settings.product != blank -%}
          <div class="ritual-step__product">
            <a href="{{ block.settings.product.url }}" class="ritual-step__product-link">
              {{ block.settings.product.title }}
            </a>
          </div>
        {%- endif -%}
      </div>
    {%- endfor -%}
  </div>
</div>

{% schema %}
{
  "name": "仪式步骤",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "标题",
      "default": "仪式步骤"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "描述",
      "default": "<p>按照以下步骤完成您的仪式</p>"
    }
  ],
  "blocks": [
    {
      "type": "step",
      "name": "步骤",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "步骤标题",
          "default": "步骤标题"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "步骤描述",
          "default": "<p>步骤描述内容</p>"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "步骤图片"
        },
        {
          "type": "range",
          "id": "image_width",
          "min": 100,
          "max": 500,
          "step": 10,
          "unit": "px",
          "label": "图片宽度",
          "default": 200
        },
        {
          "type": "product",
          "id": "product",
          "label": "推荐产品"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "仪式步骤",
      "blocks": [
        {
          "type": "step",
          "settings": {
            "title": "第一步",
            "description": "<p>准备仪式所需物品</p>"
          }
        },
        {
          "type": "step",
          "settings": {
            "title": "第二步",
            "description": "<p>按照说明进行操作</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}

<style>
  .ritual-steps {
    padding: 4rem 0;
  }
  
  .ritual-steps__header {
    text-align: center;
    margin-bottom: 3rem;
  }
  
  .ritual-steps__heading {
    font-size: 2.4rem;
    margin-bottom: 1rem;
  }
  
  .ritual-steps__container {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    gap: 2rem;
    justify-content: center;
  }
  
  .ritual-step {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    padding: 2.5rem;
    border-radius: 0.8rem;
    background-color: rgba(var(--color-background), 0.05);
    width: calc(33.33% - 2rem);
    min-width: 280px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .ritual-step:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  }

  .ritual-step::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(to bottom, var(--color-button), var(--color-button-light));
  }
  
  .ritual-step__number {
    font-weight: bold;
    color: rgba(var(--color-button), 1);
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .ritual-step__number::before {
    content: "";
    display: inline-block;
    width: 24px;
    height: 24px;
    background-color: rgba(var(--color-button), 0.1);
    border-radius: 50%;
    position: relative;
  }

  .ritual-step__number::after {
    content: counter(step);
    counter-increment: step;
    position: absolute;
    left: 6px;
    top: 50%;
    transform: translateY(-50%);
    color: rgba(var(--color-button), 1);
    font-weight: bold;
  }
  
  .ritual-step__title {
    font-size: 1.8rem;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.8rem;
  }

  .ritual-step__title::before {
    content: "";
    display: inline-block;
    width: 20px;
    height: 20px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23000'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z'/%3E%3C/svg%3E");
    background-size: contain;
    opacity: 0.7;
  }
  
  .ritual-step__image {
    margin: 1rem 0;
    position: relative;
    border-radius: 0.8rem;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  
  .ritual-step__image-element {
    border-radius: 0.5rem;
    max-width: 100%;
    height: auto;
  }
  
  .ritual-step__product-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1rem;
    padding: 0.8rem 1.5rem;
    background-color: rgba(var(--color-button), 1);
    color: rgba(var(--color-button-text), 1);
    border-radius: 0.5rem;
    text-decoration: none;
    transition: all 0.3s ease;
    font-weight: 500;
  }
  
  .ritual-step__product-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }

  .ritual-step__product-link::after {
    content: "→";
    display: inline-block;
    transition: transform 0.3s ease;
  }

  .ritual-step__product-link:hover::after {
    transform: translateX(3px);
  }

  @media (max-width: 750px) {
    .ritual-step {
      width: 100%;
    }
  }
</style>
